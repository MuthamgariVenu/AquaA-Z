<!DOCTYPE html>
<html lang="te">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Aquaculture A–Z • Home</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          boxShadow: { soft: '0 12px 28px rgba(2,6,23,.08)' }
        }
      }
    }
  </script>

  <style>
    html { scroll-behavior: smooth; }
    body { background: linear-gradient(135deg,#dbeafe 0%,#e0f2fe 50%,#f0fdf4 100%); }
    .dark body { background: linear-gradient(135deg,#071327 0%,#072f39 50%,#073b2f 100%); }
    .navbtn { border:1px solid rgb(226,232,240); padding:.55rem .9rem; border-radius:.75rem; background:#fff; text-align:center; font-weight:700; font-size:1rem; white-space:nowrap; }
    .dark .navbtn { background:#0b1220; border-color:#1f2937; color:#fff; }
    .shadow-soft{ box-shadow: 0 12px 28px rgba(2,6,23,.06); }
    .ticker{ overflow:hidden; mask-image:linear-gradient(90deg,transparent,black 8%,black 92%,transparent); -webkit-mask-image:linear-gradient(90deg,transparent,black 8%,black 92%,transparent) }
    .ticker-track{ display:flex; gap:24px; white-space:nowrap; min-width:max-content; animation:ticker 35s linear infinite }
    @keyframes ticker { from{transform:translateX(0)} to{transform:translateX(-50%)} }
    @media (max-width:640px) { .ticker{ mask-image:none; -webkit-mask-image:none } .ticker-track{ gap:16px; animation-duration:45s } }

    /* Chat UI: responsive and theme aware */
    .chat-btn {
      position: fixed;
      right: 18px;
      bottom: 18px;
      width: 56px;
      height: 56px;
      border-radius: 9999px;
      background: #0b6b6b;
      color: #fff;
      display:flex;align-items:center;justify-content:center;
      box-shadow: 0 8px 26px rgba(11,107,107,0.18);
      z-index: 60;
      border: 0;
    }
    .chat-btn.small { width:44px;height:44px; font-size:16px; right:12px; bottom:12px; }

    /* Desktop panel */
    .chat-panel {
      position: fixed;
      right: 18px;
      bottom: 86px;
      width: 380px;
      max-height: 64vh;
      background: #fff;
      border-radius: 12px;
      overflow: hidden;
      display: none;
      flex-direction: column;
      box-shadow: 0 14px 40px rgba(2,6,23,0.26);
      z-index: 70;
    }
    .dark .chat-panel { background:#071a22; color:#e6eef0; border:1px solid #0f2f33; }

    .chat-panel.open { display:flex; }
    .chat-header { display:flex; align-items:center; justify-content:space-between; padding:12px 12px; border-bottom:1px solid #eee; }
    .dark .chat-header { border-bottom:1px solid rgba(255,255,255,0.04) }
    .chat-messages { padding:12px; overflow:auto; flex:1; background:transparent; display:flex; flex-direction:column; gap:10px; }
    .chat-input-row { display:flex; gap:8px; padding:10px; border-top:1px solid #eee; background:transparent; }
    .dark .chat-input-row { border-top:1px solid rgba(255,255,255,0.04); }

    .msg { max-width:78%; padding:8px 10px; border-radius:10px; font-size:14px; line-height:1.25; }
    .msg.user{ align-self:flex-end; background:#0b6b6b; color:#fff; }
    .msg.bot{ align-self:flex-start; background:#f8fafc; color:#111; border:1px solid #eef2ff; }
    .dark .msg.bot{ background:linear-gradient(180deg,#06282b,#062e33); border:1px solid rgba(255,255,255,0.03); color:#e6eef0; }

    /* Mobile bottom-sheet behavior */
    @media (max-width:640px) {
      .chat-panel {
        left: 0;
        right: 0;
        bottom: 0;
        width: 100%;
        max-height: 86vh;
        height: auto;
        border-radius: 12px 12px 0 0;
      }
      .chat-panel.open { display:flex; }
      .chat-btn { right:12px; bottom:12px; }
    }

    /* Input styling */
    .chat-input { flex:1; border:1px solid #e6eef2; padding:10px; border-radius:10px; outline:none; }
    .dark .chat-input { border:1px solid rgba(255,255,255,0.06); background:transparent; color:inherit; }

    /* small helper */
    .hidden-sm { display:none; }
    @media(min-width:640px){ .hidden-sm{ display:block; } }

    /* Footer removal placeholder: keep page spacing tidy */
    main{ padding-bottom: 110px; } /* ensure bottom nav + chat space */
  </style>
</head>

<body class="text-slate-900 dark:text-slate-100">
  <!-- Header -->
  <header class="sticky top-0 z-30 backdrop-blur bg-white/80 dark:bg-slate-950/70 border-b border-slate-200 dark:border-slate-800">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center">
      <div class="h-9 w-9 mr-1 relative">
        <img src="assets/logo.png" alt="Logo" class="h-9 w-9 object-contain block dark:hidden">
        <img src="assets/logo-dark.png" alt="Logo" class="h-9 w-9 object-contain hidden dark:block">
      </div>
      <h1 class="text-xl font-bold hidden sm:inline">Aquaculture A–Z</h1>
      <h1 class="text-xl font-bold sm:hidden mr-14 sm:mr-0">Aquaa A–Z</h1>

      <nav class="hidden sm:flex gap-2 flex-1 justify-center">
        <a href="index.html" class="navbtn">🏠 <span data-i18n="m_home">Home</span></a>
        <a href="harvest.html" class="navbtn">🚚 <span data-i18n="t_harvest">Harvest</span></a>
        <a href="seeds.html" class="navbtn">🦐 <span data-i18n="t_seeds">Seeds</span></a>
        <a href="vendors.html" class="navbtn">🏪 <span data-i18n="t_dealers">Dealers</span></a>
        <a href="seeds.html" class="navbtn">🦐 <span data-i18n="m_shrimp">Shrimp</span></a>
        <a href="contact.html" class="navbtn">📞 <span data-i18n="contact">Contact</span></a>
      </nav>

      <div class="flex items-center gap-2 flex-none">
        <label for="langSel" class="text-sm select-none">Ln</label>
        <select id="langSel" class="text-sm border rounded-md px-2 py-1 dark:bg-slate-900 dark:border-slate-700">
          <option value="te">తెలుగు</option>
          <option value="en">English</option>
        </select>
        <button id="themeToggle" class="rounded-full px-3 py-1.5 text-sm border border-slate-200 dark:border-slate-800">🌙/☀️</button>
      </div>
    </div>
  </header>

  <main class="max-w-7xl mx-auto p-3 sm:p-4 space-y-4">
    <!-- Hero -->
    <section class="rounded-2xl p-4 bg-white dark:bg-slate-900 shadow-soft border border-slate-200/60 dark:border-slate-800">
      <div class="flex items-center justify-between">
        <h3 class="font-semibold">⚙️ <span data-i18n="m_aerator">Aerator</span></h3>
        <!-- nothing extra -->
      </div>
      <p id="heroDesc" class="mt-3 text-slate-600 dark:text-slate-300" data-i18n="aerator_desc">Aerators help maintain oxygen levels in ponds — models, power and maintenance guidance shown below.</p>
    </section>

    <!-- Flash News -->
    <section class="rounded-2xl p-4 bg-white dark:bg-slate-900 shadow-soft border border-slate-200/60 dark:border-slate-800">
      <div class="flex items-center justify-between">
        <h3 class="font-semibold">📰 <span id="flashTitle" data-i18n="flash_news">Flash News</span></h3>
        <span class="text-xs px-2 py-1 rounded-full bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-200">Live</span>
      </div>
      <div class="mt-3 ticker"><div id="newsTrackTop" class="ticker-track"></div></div>
      <p class="text-xs text-slate-500 mt-2"><span data-i18n="updated">Updated</span>: <span id="newsUpdatedTop">—</span></p>
    </section>

    <!-- Rates + Promotions (kept minimal - unchanged) -->
    <section class="grid grid-cols-1 lg:grid-cols-2 gap-4">
      <div class="rounded-2xl p-4 bg-white dark:bg-slate-900 shadow-soft border border-slate-200/60 dark:border-slate-800">
        <div class="flex items-center justify-between">
          <h3 class="font-semibold" data-i18n="snapshot">లైవ్ స్నాప్‌షాట్</h3>
          <p class="text-xs text-slate-500"><span data-i18n="updated">అప్‌డేట్</span>: <span id="updatedAt">—</span></p>
        </div>
        <div class="mt-3 overflow-x-auto">
          <table class="min-w-full text-sm" id="ratesTable">
            <thead>
              <tr class="border-b dark:border-slate-800 text-slate-500">
                <th class="text-left py-2 pr-4" data-i18n="th_count">కౌంట్</th>
                <th class="text-left py-2 pr-4" data-i18n="th_price">ధర (₹/kg)</th>
                <th class="text-left py-2 pr-4" data-i18n="th_change">మార్పు</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div class="rounded-2xl p-4 bg-white dark:bg-slate-900 shadow-soft border border-slate-200/60 dark:border-slate-800">
        <h3 class="font-semibold">📣 <span data-i18n="promotions_title">Promotions</span></h3>
        <div id="promoSlider" class="relative mt-3">
          <div id="promoTrack" class="overflow-hidden rounded-xl"></div>
          <div id="promoDots" class="mt-3 flex gap-2"></div>
        </div>
      </div>
    </section>
  </main>

  <!-- mobile bottom nav -->
  <nav class="fixed bottom-0 inset-x-0 bg-white dark:bg-slate-900 border-t border-slate-200 dark:border-slate-700 flex justify-around py-2 z-40 sm:hidden" style="padding-bottom: env(safe-area-inset-bottom);">
    <a href="index.html" class="flex flex-col items-center text-base font-semibold"><span>🏠</span><span data-i18n="m_home">Home</span></a>
    <a href="harvest.html" class="flex flex-col items-center text-base font-semibold"><span>🕘</span><span data-i18n="m_history">History</span></a>
    <a href="seeds.html" class="flex flex-col items-center text-base font-semibold"><span>🦐</span><span data-i18n="m_shrimp">Shrimp</span></a>
  </nav>

  <!-- CHAT button -->
  <button id="openChat" class="chat-btn" aria-label="Open chat">💬</button>

  <!-- Chat Panel -->
  <div id="chatPanel" class="chat-panel" role="dialog" aria-label="Chat with Aqua A-Z">
    <div class="chat-header">
      <div>
        <div id="chatTitle" class="font-semibold" data-i18n="chat_title">Help & Chat</div>
        <div id="chatSubtitle" class="text-xs text-slate-500 dark:text-slate-300">Hi! How can I help you today?</div>
      </div>
      <div class="flex items-center gap-2">
        <button id="closeChat" title="Close" style="background:none;border:none;font-size:18px;cursor:pointer">✕</button>
      </div>
    </div>

    <div id="chatMessages" class="chat-messages">
      <!-- messages appended here -->
    </div>

    <div class="chat-input-row">
      <input id="chatInput" class="chat-input" type="text" placeholder="Type a message..." aria-label="Type a message" />
      <button id="sendBtn" class="navbtn">Send</button>
    </div>
  </div>

  <script>
    /***************
     * i18n dictionary (English + Telugu)
     ***************/
    window.dict = {
      en: {
        flash_news: "Flash News",
        updated: "Updated",
        snapshot: "Live Snapshot",
        promotions_title: "Promotions",
        m_home: "Home",
        m_history: "History",
        m_shrimp: "Shrimp",
        contact: "Contact",
        t_harvest: "Harvest",
        t_seeds: "Seeds",
        t_dealers: "Dealers",
        aera_desc_short: "Aerators help maintain oxygen levels in ponds — models, power and maintenance guidance shown below.",
        aerator_desc: "Aerators help maintain oxygen levels in ponds — models, power and maintenance guidance shown below.",
        chat_title: "Help & Chat",
        chat_greeting: "Hi! How can I help you today?",
        chat_placeholder: "Type a message...",
        chat_reply_default: "Sorry, I cannot perform that now; but I can help. Please give more details.",
        chat_reply_aerator: "What details about aerators do you need? Model, capacity, or services?"
      },
      te: {
        flash_news: "తాజా వార్త",
        updated: "అప్‌డేట్",
        snapshot: "లైవ్ స్నాప్‌షాట్",
        promotions_title: "ప్రోమోషన్స్",
        m_home: "హోమ్",
        m_history: "చరిత్ర",
        m_shrimp: "రొయ్యలు",
        contact: "సంప్రదించండి",
        t_harvest: "హార్వెస్ట్",
        t_seeds: "సీడ్స్",
        t_dealers: "వెండర్లు",
        aera_desc_short: "ఎరేటర్లు చెరువుల్లో ఆక్సిజన్ స్థాయిలను నిర్వహించడంలో సహాయపడతాయి.",
        aerator_desc: "ఎరేటర్లు చెరువుల్లో ఆక్సిజన్ స్థాయిలను నిర్వహించడంలో సహాయపడతాయి — మోడల్స్, శక్తి మరియు నిర్వహణ సూచనలు కింద చూపబడ్డాయి.",
        chat_title: "సహాయం & చాట్",
        chat_greeting: "హాయ్! నేను ఈరోజు ఎలా సహాయపడగలను?",
        chat_placeholder: "మీ సందేశం రాయండి...",
        chat_reply_default: "క్షమించండి, నేను దాన్ని ఇప్పుడే చేయలేను; కానీ సహాయపడగలను. దయచేసి మరిన్ని వివరాలు ఇవ్వండి.",
        chat_reply_aerator: "ఎరేటర్ల గురించి మీరు ఏమి తెలుసుకోవాలి? మోడల్, సామర్థ్యం లేదా సేవలు?"
      }
    };

    // apply i18n for controls with data-i18n or specific ids
    function applyI18n() {
      const lang = localStorage.getItem('lang') || 'te';
      document.documentElement.lang = lang === 'en' ? 'en' : 'te';
      // elements using data-i18n attribute
      document.querySelectorAll('[data-i18n]').forEach(el=>{
        const key = el.dataset.i18n;
        if (key && window.dict[lang] && window.dict[lang][key]) el.textContent = window.dict[lang][key];
      });
      // specific ids
      document.getElementById('heroDesc').textContent = window.dict[lang].aerator_desc || '';
      document.getElementById('flashTitle').textContent = window.dict[lang].flash_news || '';
      // chat placeholder/title
      const ct = document.getElementById('chatTitle'); if (ct) ct.textContent = window.dict[lang].chat_title;
      const input = document.getElementById('chatInput'); if (input) input.placeholder = window.dict[lang].chat_placeholder;
      // chat greeting if messages empty
      if (document.getElementById('chatMessages').children.length === 0) {
        injectInitialGreeting();
      }
    }

    // theme toggle logic
    (function(){
      const themeBtn = document.getElementById('themeToggle');
      const stored = localStorage.getItem('theme');
      if (stored === 'dark' || (!stored && matchMedia && matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
        themeBtn.textContent = '☀️';
      } else {
        document.documentElement.classList.remove('dark');
        themeBtn.textContent = '🌙';
      }
      themeBtn.addEventListener('click', ()=>{
        const isDark = document.documentElement.classList.toggle('dark');
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
        themeBtn.textContent = isDark ? '☀️' : '🌙';
      });
    })();

    // language selector
    (function(){
      const sel = document.getElementById('langSel');
      if (!localStorage.getItem('lang')) localStorage.setItem('lang','te');
      sel.value = localStorage.getItem('lang') || 'te';
      sel.addEventListener('change', (e)=>{ localStorage.setItem('lang', e.target.value); applyI18n(); });
      applyI18n();
    })();

    /*******************
     * NEWS + RATES stubs (use your CSV loader if present)
     *******************/
    function nowStr(){ return new Intl.DateTimeFormat('en-IN',{dateStyle:'medium', timeStyle:'short'}).format(new Date()); }
    document.getElementById('newsUpdatedTop').textContent = nowStr();
    document.getElementById('updatedAt').textContent = nowStr();
    // dummy ticker content (replace with your CSV loader)
    const defaultNews = [
      {lang:'en',tag:'Flash',text:'Harvest prices trending up — check details.'},
      {lang:'te',tag:'అప్‌డేట్',text:'నేటి మార్కెట్ ధరలు పెరుగుతున్నాయి — వివరాలు చూడండి.'}
    ];
    function renderNews(){
      const lang = localStorage.getItem('lang') || 'te';
      const track = document.getElementById('newsTrackTop');
      const rows = defaultNews.filter(n=>n.lang===lang).map(n=>`<div class="flex items-center gap-2 pr-4"><span class="px-2 py-0.5 rounded text-[11px] bg-sky-100 dark:bg-sky-800/30">${n.tag}</span><span>${n.text}</span></div>`).join('');
      track.innerHTML = rows + rows;
    }
    renderNews();

    /*******************
     * CHAT: responsive + theme aware
     *******************/
    const openChatBtn = document.getElementById('openChat');
    const chatPanel = document.getElementById('chatPanel');
    const closeChatBtn = document.getElementById('closeChat');
    const chatMessages = document.getElementById('chatMessages');
    const chatInput = document.getElementById('chatInput');
    const sendBtn = document.getElementById('sendBtn');

    function escapeHtml(s){ return (s||'').replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
    function appendBot(en, te){
      const div = document.createElement('div'); div.className='msg bot';
      const lang = localStorage.getItem('lang') || 'te';
      // show bilingual both: english bold + telugu grey
      div.innerHTML = `<div style="font-weight:700">${escapeHtml(en)}</div><div style="font-size:13px;color:var(--tw-text-opacity, #475569);margin-top:4px">${escapeHtml(te)}</div>`;
      chatMessages.appendChild(div); chatMessages.scrollTop = chatMessages.scrollHeight;
    }
    function appendUser(text){
      const div = document.createElement('div'); div.className='msg user'; div.innerText = text; chatMessages.appendChild(div); chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function injectInitialGreeting(){
      if (chatMessages.children.length > 0) return;
      const en = window.dict.en.chat_greeting;
      const te = window.dict.te.chat_greeting;
      appendBot(en, te);
    }

    // simple "AI" reply fallback (no server)
    function botReply(userText){
      const t = (userText||'').toLowerCase();
      const enDefault = window.dict.en.chat_reply_default;
      const teDefault = window.dict.te.chat_reply_default;
      const enAer = window.dict.en.chat_reply_aerator;
      const teAer = window.dict.te.chat_reply_aerator;
      if (!userText || userText.trim().length < 2) { setTimeout(()=>appendBot(enDefault, teDefault), 500); return; }
      if (t.includes('aerator') || t.includes('ఎరేటర్')) { setTimeout(()=>appendBot(enAer, teAer), 500); return; }
      setTimeout(()=>appendBot(enDefault, teDefault), 500);
    }

    // open/close chat behavior (responsive)
    function isMobileViewport(){ return window.matchMedia('(max-width:640px)').matches; }

    openChatBtn.addEventListener('click', ()=>{
      // small adjust on mobile: open bottom sheet and focus input
      chatPanel.classList.add('open');
      // make chat button smaller on mobile
      if (isMobileViewport()) openChatBtn.classList.add('small');
      setTimeout(()=>{ chatInput.focus(); }, 220);
    });

    closeChatBtn.addEventListener('click', ()=>{
      chatPanel.classList.remove('open');
      openChatBtn.classList.remove('small');
    });

    sendBtn.addEventListener('click', ()=>{
      const txt = chatInput.value.trim();
      if (!txt) return;
      appendUser(txt);
      chatInput.value = '';
      botReply(txt);
    });

    chatInput.addEventListener('keydown', (e)=>{
      if (e.key === 'Enter') { e.preventDefault(); sendBtn.click(); }
    });

    // ensure chat theme updates with page theme
    const observer = new MutationObserver(()=>{
      // when dark class toggles, chat panel style will reflect via CSS .dark .chat-panel
    });
    observer.observe(document.documentElement, { attributes: true, attributeFilter: ['class'] });

    // mobile keyboard overlap mitigation:
    // on focus of input on mobile, reduce chat-panel max-height to viewport height - keyboard safe
    function adjustForKeyboard(){
      if (!isMobileViewport()) { chatPanel.style.maxHeight = '64vh'; return; }
      // use visualViewport if available
      if (window.visualViewport) {
        const v = window.visualViewport;
        const targetMax = Math.max(260, v.height - 140); // keep input visible
        chatPanel.style.maxHeight = targetMax + 'px';
      } else {
        chatPanel.style.maxHeight = '70vh';
      }
    }
    window.addEventListener('resize', adjustForKeyboard);
    chatInput.addEventListener('focus', adjustForKeyboard);
    chatInput.addEventListener('blur', ()=>{ if (isMobileViewport()) chatPanel.style.maxHeight = '86vh'; });

    // init
    document.addEventListener('DOMContentLoaded', ()=>{
      // make initial greeting
      injectInitialGreeting();

      // small improvement: close chat if user scrolls away on mobile
      window.addEventListener('scroll', ()=>{
        if (isMobileViewport() && chatPanel.classList.contains('open')) {
          // don't auto-close aggressively; keep open
        }
      });

      // ensure placeholder text uses chosen language
      applyI18n();
    });

    /******************
     * Small accessibility: close chat on Escape
     ******************/
    document.addEventListener('keydown', (e)=>{
      if (e.key === 'Escape' && chatPanel.classList.contains('open')) {
        chatPanel.classList.remove('open');
      }
    });

    /******************
     * Remove the "kinda matter" bottom block (you requested removal)
     * (We do nothing here because we've removed that block from DOM)
     ******************/

  </script>
</body>
</html>
