<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Aerator ‚Äî Aquaculture A‚ÄìZ</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { darkMode: 'class', theme: { extend: { boxShadow:{ soft:'0 12px 28px rgba(2,6,23,.08)' } } } }
  </script>

  <style>
    html{scroll-behavior:smooth}
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:#0f172a;background:linear-gradient(135deg,#e6f7ff 0%,#f0fbf7 100%)}
    .container{max-width:1100px;margin:0 auto;padding:12px}
    header{position:sticky;top:0;z-index:40;background:transparent}
    .btn{display:inline-flex;align-items:center;gap:.5rem;padding:.55rem .85rem;border-radius:.65rem;border:1px solid #e6eef6;background:white;font-weight:700;cursor:pointer}
    .btn.primary{background:#059669;color:#fff;border-color:#059669}
    .card{background:white;border-radius:.8rem;border:1px solid #e6eef6;overflow:hidden}
    .card-img{width:100%;height:120px;object-fit:cover;background:#f6fbff;display:block}
    .fans-pill{display:inline-block;padding:.12rem .5rem;border-radius:999px;font-weight:800;background:#ecfdf5;color:#065f46;margin-right:.5rem}
    .hp-pill{display:inline-block;padding:.12rem .5rem;border-radius:999px;font-weight:700;background:#f0f9ff;color:#065f46;margin-left:8px;font-size:12px}
    .big-units{font-size:48px;font-weight:900;color:#065f46}
    .mapping-title{font-weight:800;color:#065f46;margin-top:10px}
    .mapping-row{margin-top:6px;color:#055a37;font-weight:700}
    .hidden{display:none}
    .modal-backdrop{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(2,6,23,0.35);z-index:60}
    .modal{width:94%;max-width:520px;background:white;border-radius:12px;padding:16px}
    .toast{position:fixed;right:16px;bottom:24px;z-index:80;min-width:220px;background:rgba(2,6,23,0.9);color:white;padding:10px 14px;border-radius:12px;display:none}
    @media(min-width:768px){ .two-col{display:grid;grid-template-columns:1fr 420px;gap:16px} }
    .dark body{background:linear-gradient(135deg,#081426 0%,#052733 100%);color:#e6f0f6}
    .dark .card{background:#06202c;border-color:#08303f}
    .dark .btn{background:#071822;color:#cfeff1;border-color:#0b2b36}
    .dark .btn.primary{background:#10b981}
  </style>
</head>
<body>

  <!-- Header: Back, language, theme toggle -->
  <header>
    <div class="container flex items-center justify-between py-3">
      <div class="flex items-center gap-3">
        <button id="backBtn" class="btn" onclick="history.back()">‚Üê <span id="lblBack">Back</span></button>
      </div>
      <div class="flex items-center gap-2">
        <select id="langSel" class="btn" aria-label="Language">
          <option value="en">English</option>
          <option value="te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</option>
        </select>
        <button id="themeToggle" class="btn" title="Toggle theme">üåô</button>
      </div>
    </div>
  </header>

  <main class="container pb-24">
    <section class="card p-4 mb-4">
      <h1 id="pageTitle" class="text-xl font-bold">Aerator</h1>
      <p id="pageDesc" class="mt-2 text-slate-600">Aerators help maintain oxygen levels in ponds ‚Äî use the calculator to see how many devices you need.</p>
    </section>

    <!-- Calculator -->
    <section id="calculatorArea" class="card p-4 mb-4">
      <h2 id="calcTitle" class="font-semibold mb-3">Aerator Calculator</h2>

      <label id="lblArea" class="text-xs font-medium">Pond area (acres)</label>
      <input id="acreInput" type="number" step="0.01" min="0.01" placeholder="eg. 0.5" class="mt-2 w-full rounded-lg border px-3 py-2" />

      <label id="lblDepth" class="text-xs font-medium mt-3 block">Average depth (ft)</label>
      <input id="depthFtInput" type="number" step="0.1" min="0.1" placeholder="eg. 4" class="mt-2 w-full rounded-lg border px-3 py-2" />

      <label id="lblPrawn" class="text-xs font-medium mt-3 block">Prawn size</label>
      <select id="prawnSize" class="mt-2 w-full rounded-lg border px-3 py-2">
        <option value="small">Small</option>
        <option value="medium">Medium (+20%)</option>
        <option value="large">Large (+40%)</option>
      </select>

      <div class="mt-4 flex gap-2">
        <button id="calcBtn" class="btn primary flex-1">Calculate</button>
        <button id="resetBtn" class="btn">Reset</button>
      </div>

      <!-- Result -->
      <div id="resultPanel" class="mt-4 hidden">
        <div id="unitsBox" class="p-4 rounded-lg" style="background:#ecfdf5;border:1px solid #bbf7d0">
          <div id="unitsLabel" class="text-sm text-slate-700">Units required</div>
          <div id="unitsBig" class="big-units mt-2">0 units</div>
          <div id="unitsNote" class="text-xs text-slate-600 mt-2">Devices measured as 'units' based on motor HP.</div>

          <!-- Aerator mapping (only two mapped entries) -->
          <div class="mapping-title" id="mappingTitle">Aerator Mapping</div>
          <div class="mapping-row" id="mapping2">2-fans ‚Üí 1 HP = 1 unit</div>
          <div class="mapping-row" id="mapping4">4-fans ‚Üí 2 HP = 2 units</div>

          <!-- explicit mapping counts (1HP/2HP) -->
          <div id="hpCounts" class="mt-3 text-sm" style="color:#064e3b;font-weight:700"></div>
        </div>

        <div class="mt-4 flex gap-2">
          <button id="showNewBtn" class="btn">New Aerators</button>
          <button id="showOldBtn" class="btn">Old Aerators</button>
        </div>

        <div id="modelsSummary" class="mt-4 space-y-2"></div>
      </div>

      <p class="mt-4 text-xs text-slate-500" id="calcNote">Note: estimate only ‚Äî verify product specs.</p>
    </section>

    <!-- Models listing (shown when clicking New/Old) -->
    <section id="modelsArea" class="hidden mb-8">
      <div class="flex items-center justify-between mb-3">
        <div class="flex items-center gap-2">
          <button id="tabNew" class="btn">New Aerators</button>
          <button id="tabOld" class="btn">Old Aerators</button>
        </div>
        <div><button id="backToCalcBtn" class="btn">Back to calculator</button></div>
      </div>

      <div id="modelsGrid" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <!-- New -->
        <article class="card p-3" data-type="new" data-key="float-2" data-units="1" data-price="12000" data-fans="2" data-hp="1">
          <img class="card-img" src="assets/float-2.jpg" alt="2 Fans" onerror="this.style.opacity=.6" />
          <div class="mt-3">
            <div class="flex items-start justify-between">
              <div>
                <span class="fans-pill">2</span><span class="hp-pill">‚âà 1 HP ‚Ä¢ 1 unit</span>
                <div class="font-bold model-name" data-name-en="Floating ‚Äî 2 Fans" data-name-te="‡∞§‡±á‡∞≤‡±á ‚Äî 2 ‡∞´‡±ç‡∞Ø‡∞æ‡∞®‡±ç‡∞∏‡±ç">Floating ‚Äî 2 Fans</div>
                <div class="text-xs text-slate-500 mt-1">Flow: 8,000 L/h ¬∑ Power: 150 W</div>
              </div>
              <div class="font-semibold">‚Çπ 12,000</div>
            </div>
            <p class="mt-2 text-sm text-slate-600 model-desc" data-desc-en="Surface floating; economical for small ponds." data-desc-te="‡∞™‡±à‡∞® ‡∞§‡±á‡∞≤‡±á ‡∞∞‡∞ï‡∞Ç; ‡∞ö‡∞ø‡∞®‡±ç‡∞® ‡∞ö‡±Ü‡∞∞‡±Å‡∞µ‡±Å‡∞≤ ‡∞ï‡±ã‡∞∏‡∞Ç ‡∞∏‡∞∞‡∞∏‡∞Æ‡±à‡∞®‡∞¶‡∞ø.">Surface floating; economical for small ponds.</p>
            <div class="mt-3 flex gap-2">
              <button class="btn detailsBtn flex-1">Details</button>
              <button class="btn primary buyBtn" data-key="float-2" data-price="12000">Buy</button>
            </div>
          </div>
        </article>

        <article class="card p-3" data-type="new" data-key="float-4" data-units="2" data-price="22000" data-fans="4" data-hp="2">
          <img class="card-img" src="assets/float-4.jpg" alt="4 Fans" onerror="this.style.opacity=.6" />
          <div class="mt-3">
            <div class="flex items-start justify-between">
              <div>
                <span class="fans-pill">4</span><span class="hp-pill">‚âà 2 HP ‚Ä¢ 2 units</span>
                <div class="font-bold model-name" data-name-en="Floating ‚Äî 4 Fans" data-name-te="‡∞§‡±á‡∞≤‡±á ‚Äî 4 ‡∞´‡±ç‡∞Ø‡∞æ‡∞®‡±ç‡∞∏‡±ç">Floating ‚Äî 4 Fans</div>
                <div class="text-xs text-slate-500 mt-1">Flow: 16,000 L/h ¬∑ Power: 300 W</div>
              </div>
              <div class="font-semibold">‚Çπ 22,000</div>
            </div>
            <p class="mt-2 text-sm text-slate-600 model-desc" data-desc-en="Good for medium ponds." data-desc-te="‡∞Æ‡∞ß‡±ç‡∞Ø ‡∞ö‡±Ü‡∞∞‡±Å‡∞µ‡±Å‡∞≤‡∞ï‡±Å ‡∞∏‡∞∞‡±à‡∞®‡∞¶‡∞ø.">Good for medium ponds.</p>
            <div class="mt-3 flex gap-2">
              <button class="btn detailsBtn flex-1">Details</button>
              <button class="btn primary buyBtn" data-key="float-4" data-price="22000">Buy</button>
            </div>
          </div>
        </article>

        <article class="card p-3" data-type="new" data-key="float-6" data-units="3" data-price="32000" data-fans="6" data-hp="3">
          <img class="card-img" src="assets/float-6.jpg" alt="6 Fans" onerror="this.style.opacity=.6" />
          <div class="mt-3">
            <div class="flex items-start justify-between">
              <div>
                <span class="fans-pill">6</span><span class="hp-pill">‚âà 3 HP ‚Ä¢ 3 units</span>
                <div class="font-bold model-name" data-name-en="Floating ‚Äî 6 Fans" data-name-te="‡∞§‡±á‡∞≤‡±á ‚Äî 6 ‡∞´‡±ç‡∞Ø‡∞æ‡∞®‡±ç‡∞∏‡±ç">Floating ‚Äî 6 Fans</div>
                <div class="text-xs text-slate-500 mt-1">Flow: 24,000 L/h ¬∑ Power: 450 W</div>
              </div>
              <div class="font-semibold">‚Çπ 32,000</div>
            </div>
            <p class="mt-2 text-sm text-slate-600 model-desc" data-desc-en="High circulation for larger ponds." data-desc-te="‡∞™‡±Ü‡∞¶‡±ç‡∞¶ ‡∞ö‡±Ü‡∞∞‡±Å‡∞µ‡±Å‡∞≤‡∞ï‡±Å ‡∞Ö‡∞ß‡∞ø‡∞ï ‡∞∏‡∞∞‡±ç‡∞ï‡±ç‡∞Ø‡±Å‡∞≤‡±á‡∞∑‡∞®‡±ç.">High circulation for larger ponds.</p>
            <div class="mt-3 flex gap-2">
              <button class="btn detailsBtn flex-1">Details</button>
              <button class="btn primary buyBtn" data-key="float-6" data-price="32000">Buy</button>
            </div>
          </div>
        </article>

        <article class="card p-3" data-type="new" data-key="float-8" data-units="4" data-price="42000" data-fans="8" data-hp="4">
          <img class="card-img" src="assets/float-8.jpg" alt="8 Fans" onerror="this.style.opacity=.6" />
          <div class="mt-3">
            <div class="flex items-start justify-between">
              <div>
                <span class="fans-pill">8</span><span class="hp-pill">‚âà 4 HP ‚Ä¢ 4 units</span>
                <div class="font-bold model-name" data-name-en="Floating ‚Äî 8 Fans" data-name-te="‡∞§‡±á‡∞≤‡±á ‚Äî 8 ‡∞´‡±ç‡∞Ø‡∞æ‡∞®‡±ç‡∞∏‡±ç">Floating ‚Äî 8 Fans</div>
                <div class="text-xs text-slate-500 mt-1">Flow: 32,000 L/h ¬∑ Power: 600 W</div>
              </div>
              <div class="font-semibold">‚Çπ 42,000</div>
            </div>
            <p class="mt-2 text-sm text-slate-600 model-desc" data-desc-en="Commercial ponds." data-desc-te="‡∞µ‡∞æ‡∞£‡∞ø‡∞ú‡±ç‡∞Ø ‡∞Ö‡∞µ‡∞∏‡∞∞‡∞æ‡∞≤‡∞ï‡±Å.">Commercial ponds.</p>
            <div class="mt-3 flex gap-2">
              <button class="btn detailsBtn flex-1">Details</button>
              <button class="btn primary buyBtn" data-key="float-8" data-price="42000">Buy</button>
            </div>
          </div>
        </article>

        <!-- Used (hidden by default) -->
        <article class="card p-3" data-type="old" data-key="used-2" data-units="1" data-price="7500" data-fans="2" data-hp="1" style="display:none">
          <img class="card-img" src="assets/used-2.jpg" alt="Used 2 Fans" onerror="this.style.opacity=.6" />
          <div class="mt-3">
            <div class="flex items-start justify-between">
              <div>
                <span class="fans-pill">2</span><span class="hp-pill">‚âà 1 HP ‚Ä¢ 1 unit</span>
                <div class="font-bold model-name" data-name-en="Used ‚Äî 2 Fans" data-name-te="‡∞∞‡±Ü‡∞Ç‡∞°‡∞µ ‡∞ö‡±á‡∞§‡∞ø ‚Äî 2 ‡∞´‡±ç‡∞Ø‡∞æ‡∞®‡±ç‡∞∏‡±ç">Used ‚Äî 2 Fans</div>
                <div class="text-xs text-slate-500 mt-1">Flow: 7,000 L/h ¬∑ Power: 140 W</div>
              </div>
              <div class="font-semibold">‚Çπ 7,500</div>
            </div>
            <p class="mt-2 text-sm text-slate-600 model-desc" data-desc-en="Checked used unit." data-desc-te="‡∞∏‡∞∞‡∞ø ‡∞ö‡±Ç‡∞∏‡∞ø‡∞® ‡∞∞‡±Ü‡∞Ç‡∞°‡∞µ ‡∞ö‡±á‡∞§‡∞ø ‡∞Ø‡±Ç‡∞®‡∞ø‡∞ü‡±ç.">Checked used unit.</p>
            <div class="mt-3 flex gap-2">
              <button class="btn detailsBtn flex-1">Details</button>
              <button class="btn primary buyBtn" data-key="used-2" data-price="7500">Buy</button>
            </div>
          </div>
        </article>

        <article class="card p-3" data-type="old" data-key="used-4" data-units="2" data-price="13500" data-fans="4" data-hp="2" style="display:none">
          <img class="card-img" src="assets/used-4.jpg" alt="Used 4 Fans" onerror="this.style.opacity=.6" />
          <div class="mt-3">
            <div class="flex items-start justify-between">
              <div>
                <span class="fans-pill">4</span><span class="hp-pill">‚âà 2 HP ‚Ä¢ 2 units</span>
                <div class="font-bold model-name" data-name-en="Used ‚Äî 4 Fans" data-name-te="‡∞∞‡±Ü‡∞Ç‡∞°‡∞µ ‡∞ö‡±á‡∞§‡∞ø ‚Äî 4 ‡∞´‡±ç‡∞Ø‡∞æ‡∞®‡±ç‡∞∏‡±ç">Used ‚Äî 4 Fans</div>
                <div class="text-xs text-slate-500 mt-1">Flow: 14,000 L/h ¬∑ Power: 280 W</div>
              </div>
              <div class="font-semibold">‚Çπ 13,500</div>
            </div>
            <p class="mt-2 text-sm text-slate-600 model-desc" data-desc-en="Serviced used unit." data-desc-te="‡∞∏‡∞∞‡±ç‡∞µ‡±Ä‡∞∏‡±ç ‡∞ö‡±á‡∞∏‡∞ø‡∞® ‡∞∞‡±Ü‡∞Ç‡∞°‡∞µ ‡∞ö‡±á‡∞§‡∞ø.">Serviced used unit.</p>
            <div class="mt-3 flex gap-2">
              <button class="btn detailsBtn flex-1">Details</button>
              <button class="btn primary buyBtn" data-key="used-4" data-price="13500">Buy</button>
            </div>
          </div>
        </article>

      </div>
    </section>

  </main>

  <!-- Details Modal -->
  <div id="detailsModal" class="modal-backdrop"><div class="modal">
    <div class="flex items-center justify-between"><h3 id="detailTitle">Model</h3><button id="closeDetail" class="btn">‚úï</button></div>
    <div id="detailSub" class="text-sm text-slate-600 mt-2"></div>
    <div id="detailBody" class="mt-3 text-sm"></div>
    <div class="mt-4 flex justify-end gap-2"><button id="detailBuy" class="btn primary">Buy</button><button id="detailClose" class="btn">Close</button></div>
  </div></div>

  <!-- Purchase Modal -->
  <div id="purchaseModal" class="modal-backdrop"><div class="modal">
    <div class="flex items-center justify-between"><h3 id="purchaseTitle">Buy</h3><button id="closePurchase" class="btn">‚úï</button></div>
    <form id="purchaseForm" class="mt-3">
      <input type="hidden" id="purchaseModelKey" name="model"/>
      <input type="hidden" id="purchasePrice" name="price"/>
      <label class="text-xs">Name</label><input id="buyerName" class="w-full rounded-lg border px-3 py-2 mt-1" required/>
      <label class="text-xs mt-2">Phone</label><input id="buyerPhone" class="w-full rounded-lg border px-3 py-2 mt-1" required/>
      <label class="text-xs mt-2">Place</label><input id="buyerPlace" class="w-full rounded-lg border px-3 py-2 mt-1"/>
      <div class="mt-3 flex justify-end gap-2"><button class="btn primary" type="submit">Send request</button><button id="cancelPurchaseBtn" type="button" class="btn">Cancel</button></div>
    </form>
  </div></div>

  <div id="toast" class="toast"></div>

<script>
  const dict = {
    en: {
      Back:'Back',
      pageTitle:'Aerator', pageDesc:'Aerators help maintain oxygen levels in ponds ‚Äî use the calculator to see how many devices you need.',
      calcTitle:'Aerator Calculator', lblArea:'Pond area (acres)', lblDepth:'Average depth (ft)', lblPrawn:'Prawn size',
      small:'Small', medium:'Medium (+20%)', large:'Large (+40%)',
      calcBtn:'Calculate', resetBtn:'Reset',
      unitsLabel:'Units required', unitsNote:'Devices measured as units based on motor HP.',
      viewNew:'New Aerators', viewOld:'Old Aerators', backToCalc:'Back to calculator',
      details:'Details', buy:'Buy', calcNote:'Note: estimate only ‚Äî verify product specs.',
      mapping2:'2-fans ‚Üí 1 HP = 1 unit', mapping4:'4-fans ‚Üí 2 HP = 2 units',
      hp1Label:'1 HP devices (2-fans):', hp2Label:'2 HP devices (4-fans):'
    },
    te: {
      Back:'‡∞µ‡±Ü‡∞®‡∞ï‡±ç‡∞ï‡∞ø',
      pageTitle:'‡∞é‡∞∞‡±á‡∞ü‡∞∞‡±ç', pageDesc:'‡∞é‡∞∞‡±á‡∞ü‡∞∞‡±ç‡∞≤‡±Å ‡∞ö‡±Ü‡∞∞‡±Å‡∞µ‡±Å‡∞≤‡±ç‡∞≤‡±ã ‡∞Ü‡∞ï‡±ç‡∞∏‡∞ø‡∞ú‡∞®‡±ç ‡∞∏‡±ç‡∞•‡∞æ‡∞Ø‡±Å‡∞≤‡∞®‡±Å ‡∞®‡∞ø‡∞≤‡±Å‡∞™‡±Å‡∞ï‡±Å‡∞®‡±á‡∞Ç‡∞¶‡±Å‡∞ï‡±Å ‡∞â‡∞™‡∞Ø‡±ã‡∞ó‡∞™‡∞°‡∞§‡∞æ‡∞Ø‡∞ø ‚Äî ‡∞ï‡∞ø‡∞Ç‡∞¶ ‡∞≤‡±Ü‡∞ï‡±ç‡∞ï‡∞ø‡∞Ç‡∞™‡±Å ‡∞¶‡±ç‡∞µ‡∞æ‡∞∞‡∞æ ‡∞é‡∞Ç‡∞§ ‡∞Ö‡∞µ‡∞∏‡∞∞‡∞Ç ‡∞Ö‡∞®‡±á ‡∞§‡±Ü‡∞≤‡±Å‡∞∏‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø.',
      calcTitle:'‡∞é‡∞∞‡±á‡∞ü‡∞∞‡±ç ‡∞ï‡±á‡∞≤‡±ç‡∞ï‡±ç‡∞Ø‡±Å‡∞≤‡±á‡∞ü‡∞∞‡±ç', lblArea:'‡∞ö‡±Ü‡∞∞‡±Å‡∞µ‡±Å ‡∞â‡∞™‡∞∞‡∞ø‡∞§‡∞≤‡∞Ç (‡∞é‡∞ï‡∞∞‡∞æ‡∞≤‡±Å)', lblDepth:'‡∞∏‡∞ó‡∞ü‡±Å ‡∞≤‡±ã‡∞§‡±Å (‡∞´‡±Å‡∞ü‡±ç‡∞∏‡±ç)', lblPrawn:'‡∞∞‡±ä‡∞Ø‡±ç‡∞Ø‡∞≤ ‡∞™‡∞∞‡±Å‡∞ó‡±Å/‡∞ï‡∞≤‡∞µ',
      small:'‡∞ö‡∞ø‡∞®‡±ç‡∞®', medium:'‡∞Æ‡∞ß‡±ç‡∞Ø‡∞§‡∞∞‡∞π‡∞æ (+20%)', large:'‡∞™‡±Ü‡∞¶‡±ç‡∞¶ (+40%)',
      calcBtn:'‡∞≤‡±Ü‡∞ï‡±ç‡∞ï‡∞ø‡∞Ç‡∞ö‡±Å', resetBtn:'‡∞∞‡±Ä‡∞∏‡±Ü‡∞ü‡±ç',
      unitsLabel:'‡∞Ö‡∞µ‡∞∏‡∞∞‡∞Æ‡±à‡∞® ‡∞Ø‡±Ç‡∞®‡∞ø‡∞ü‡±ç‡∞≤‡±Å', unitsNote:'‡∞â‡∞™‡∞ï‡∞∞‡∞£‡∞æ‡∞≤‡±Å ‡∞Æ‡±ã‡∞ü‡∞æ‡∞∞‡±ç HP ‡∞Ü‡∞ß‡∞æ‡∞∞‡∞Ç‡∞ó‡∞æ ‡∞Ø‡±Ç‡∞®‡∞ø‡∞ü‡±ç‡∞≤‡±Å‡∞ó‡∞æ ‡∞ï‡±ä‡∞≤‡∞µ‡∞¨‡∞°‡±ç‡∞°‡∞æ‡∞Ø‡∞ø.',
      viewNew:'‡∞ï‡±ä‡∞§‡±ç‡∞§ ‡∞é‡∞∞‡±á‡∞ü‡∞∞‡±ç‡∞≤‡±Å', viewOld:'‡∞™‡∞æ‡∞§ ‡∞é‡∞∞‡±á‡∞ü‡∞∞‡±ç‡∞≤‡±Å', backToCalc:'‡∞ï‡±ç‡∞Ø‡∞æ‡∞≤‡±ç‡∞ï‡±ç‡∞Ø‡±Å‡∞≤‡±á‡∞ü‡∞∞‡±ç‚Äå‡∞ï‡±Å ‡∞µ‡±Ü‡∞≥‡±ç‡∞≥‡±Å',
      details:'‡∞µ‡∞ø‡∞µ‡∞∞‡∞æ‡∞≤‡±Å', buy:'‡∞ï‡±ä‡∞®‡∞Ç‡∞°‡∞ø', calcNote:'‡∞ó‡∞Æ‡∞®‡∞ø‡∞ï: ‡∞á‡∞¶‡∞ø ‡∞Ö‡∞Ç‡∞ö‡∞®‡∞æ ‡∞Æ‡∞æ‡∞§‡±ç‡∞∞‡∞Æ‡±á ‚Äî ‡∞∏‡±ç‡∞™‡±Ü‡∞ï‡±ç‡∞∏‡±ç ‡∞®‡∞ø‡∞∞‡±ç‡∞ß‡∞æ‡∞∞‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø.',
      mapping2:'2-fans ‚Üí 1 HP = 1 ‡∞Ø‡±Ç‡∞®‡∞ø‡∞ü‡±ç', mapping4:'4-fans ‚Üí 2 HP = 2 ‡∞Ø‡±Ç‡∞®‡∞ø‡∞ü‡±ç‡∞≤‡±Å',
      hp1Label:'1 HP ‡∞™‡∞∞‡∞ø‡∞ï‡∞∞‡∞æ‡∞≤‡±Å (2-fans):', hp2Label:'2 HP ‡∞™‡∞∞‡∞ø‡∞ï‡∞∞‡∞æ‡∞≤‡±Å (4-fans):'
    }
  };

  const $ = id => document.getElementById(id);
  const qsa = (sel, root=document) => Array.from(root.querySelectorAll(sel));
  let lang = localStorage.getItem('lang') || 'en';

  function applyLang(){
    lang = localStorage.getItem('lang') || lang;
    const d = dict[lang];
    $('lblBack').textContent = d.Back;
    $('pageTitle').textContent = d.pageTitle;
    $('pageDesc').textContent = d.pageDesc;
    $('calcTitle').textContent = d.calcTitle;
    $('lblArea').textContent = d.lblArea;
    $('lblDepth').textContent = d.lblDepth;
    $('lblPrawn').textContent = d.lblPrawn;
    $('prawnSize').options[0].text = d.small;
    $('prawnSize').options[1].text = d.medium;
    $('prawnSize').options[2].text = d.large;
    $('calcBtn').textContent = d.calcBtn;
    $('resetBtn').textContent = d.resetBtn;
    $('unitsLabel').textContent = d.unitsLabel;
    $('unitsNote').textContent = d.unitsNote;
    $('showNewBtn').textContent = d.viewNew;
    $('showOldBtn').textContent = d.viewOld;
    $('calcNote').textContent = d.calcNote;
    $('tabNew').textContent = d.viewNew;
    $('tabOld').textContent = d.viewOld;
    $('mappingTitle').textContent = (lang==='te')? '‡∞é‡∞∞‡±á‡∞ü‡∞∞‡±ç ‡∞Æ‡±ç‡∞Ø‡∞æ‡∞™‡∞ø‡∞Ç‡∞ó‡±ç' : 'Aerator Mapping';
    $('mapping2').textContent = d.mapping2;
    $('mapping4').textContent = d.mapping4;

    // models text
    qsa('.model-name').forEach(el=>{
      const en = el.getAttribute('data-name-en')||el.textContent;
      const te = el.getAttribute('data-name-te')||en;
      el.textContent = (lang==='te')? te : en;
    });
    qsa('.model-desc').forEach(el=>{
      const en = el.getAttribute('data-desc-en')||'';
      const te = el.getAttribute('data-desc-te')||en;
      el.textContent = (lang==='te')? te : en;
    });
    qsa('.detailsBtn').forEach(b=>b.textContent = d.details);
    qsa('.buyBtn').forEach(b=>b.textContent = d.buy);
  }

  function showToast(txt, time=3000){ const t=$('toast'); t.textContent=txt; t.style.display='block'; clearTimeout(t._t); t._t=setTimeout(()=>t.style.display='none', time); }

  // Calculation logic
  const BASE_UNITS_PER_ACRE = 8;
  function calculateUnitsNeeded(acres, sizeKey){
    const sizeMultipliers = { small:1.0, medium:1.2, large:1.4 };
    const m = sizeMultipliers[sizeKey] || 1.0;
    const units = acres * BASE_UNITS_PER_ACRE * m;
    return Math.max(0, units);
  }

  function computeDevicesFromUnits(unitsNeeded){
    const cards = qsa('#modelsGrid article');
    const results = cards.map(card=>{
      const key = card.getAttribute('data-key');
      const deviceUnits = parseFloat(card.getAttribute('data-units'))||1;
      const price = parseFloat(card.getAttribute('data-price'))||0;
      const devicesReq = Math.ceil(unitsNeeded / deviceUnits);
      return { key, card, deviceUnits, price, devicesReq, totalPrice: devicesReq*price, fans: card.getAttribute('data-fans')||'', hp: card.getAttribute('data-hp')||'' };
    });
    results.sort((a,b)=> a.totalPrice - b.totalPrice );
    return results;
  }

  function escapeHtml(s){ return (s||'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

  // theme toggle
  function applyThemeFromStorage(){
    const t = localStorage.getItem('theme') || 'light';
    if(t==='dark') document.documentElement.classList.add('dark');
    else document.documentElement.classList.remove('dark');
    $('themeToggle').textContent = (t==='dark')? '‚òÄÔ∏è' : 'üåô';
  }

  document.addEventListener('DOMContentLoaded', ()=>{
    // init lang & theme selectors
    $('langSel').value = localStorage.getItem('lang') || lang;
    $('langSel').addEventListener('change', e=>{ localStorage.setItem('lang', e.target.value); applyLang(); });
    applyLang();

    applyThemeFromStorage();
    $('themeToggle').addEventListener('click', ()=>{
      document.documentElement.classList.toggle('dark');
      localStorage.setItem('theme', document.documentElement.classList.contains('dark')? 'dark' : 'light');
      applyThemeFromStorage();
    });

    // calculate/reset
    $('calcBtn').addEventListener('click', ()=>{
      const acres = parseFloat($('acreInput').value) || 0;
      const depthFt = parseFloat($('depthFtInput').value) || 0;
      const sizeKey = $('prawnSize').value||'small';
      if(acres<=0 || depthFt<=0){ showToast((lang==='te')? '‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞∏‡∞∞‡±à‡∞® ‡∞µ‡∞ø‡∞≤‡±Å‡∞µ‡∞≤‡±Å ‡∞á‡∞µ‡±ç‡∞µ‡∞Ç‡∞°‡∞ø.' : 'Please enter valid values.'); return; }

      const units = calculateUnitsNeeded(acres, sizeKey);
      const unitsRounded = Math.ceil(units);
      const unitWord = (lang==='te')? ' ‡∞Ø‡±Ç‡∞®‡∞ø‡∞ü‡±ç‡∞≤‡±Å' : ' units';
      $('unitsBig').textContent = unitsRounded.toLocaleString('en-IN') + unitWord;

      // also compute hp mapping counts:
      // 1 HP devices (2-fans) -> deviceUnits=1
      // 2 HP devices (4-fans) -> deviceUnits=2
      const hp1Count = Math.ceil(units / 1);
      const hp2Count = Math.ceil(units / 2);
      const hp1Label = dict[lang].hp1Label;
      const hp2Label = dict[lang].hp2Label;
      $('hpCounts').textContent = `${hp1Label} ${hp1Count.toLocaleString('en-IN')}  ‚Ä¢  ${hp2Label} ${hp2Count.toLocaleString('en-IN')}`;

      // render devices summary
      const devices = computeDevicesFromUnits(units);
      const summary = $('modelsSummary'); summary.innerHTML='';
      devices.forEach((r, idx)=>{
        if (r.card.getAttribute('data-type') === 'new' || r.card.getAttribute('data-type')==='old') {
          const modelNameEl = r.card.querySelector('.model-name');
          const modelName = modelNameEl ? modelNameEl.textContent : r.key;
          const block = document.createElement('div');
          block.className = 'p-3 rounded-lg flex items-center justify-between';
          block.style.background = (idx===0)? '#ecfdf5' : '#fbfbfb';
          block.innerHTML = `<div style="font-weight:800">${escapeHtml(r.fans)} ‚Äî ${escapeHtml(modelName)}</div>
            <div style="text-align:right">
              <div style="font-weight:900;color:${idx===0? '#065f46':'#0f172a'};font-size:20px">${r.devicesReq.toLocaleString('en-IN')}<span style="font-size:14px;font-weight:700;color:#64748b"> ${(lang==='te')? ' ‡∞Ø‡±Ç‡∞®‡∞ø‡∞ü‡±ç‡∞≤‡±Å' : ' units'}</span></div>
              <div style="font-size:12px;color:#475569">(${r.totalPrice? '‚Çπ'+r.totalPrice.toLocaleString('en-IN') : ''})</div>
            </div>`;
          summary.appendChild(block);
        }
      });

      $('resultPanel').classList.remove('hidden');
      window._lastCalc = { acres, depthFt, sizeKey, units, devices };
    });

    $('resetBtn').addEventListener('click', ()=>{
      $('acreInput').value=''; $('depthFtInput').value=''; $('prawnSize').value='small';
      $('resultPanel').classList.add('hidden'); $('modelsSummary').innerHTML=''; $('hpCounts').textContent=''; $('unitsBig').textContent='0 units';
      qsa('#modelsGrid article').forEach(a=>{ a.classList.remove('recommended'); const rb=a.querySelector('.recommend-badge'); if(rb) rb.remove(); });
    });

    // New/Old buttons
    $('showNewBtn').addEventListener('click', ()=> showModels('new'));
    $('showOldBtn').addEventListener('click', ()=> showModels('old'));
    $('tabNew').addEventListener('click', ()=> showModels('new'));
    $('tabOld').addEventListener('click', ()=> showModels('old'));
    $('backToCalcBtn').addEventListener('click', ()=> { $('modelsArea').classList.add('hidden'); window.scrollTo({top:0,behavior:'smooth'}); });

    // model card actions (details & buy)
    $('modelsGrid').addEventListener('click', ev=>{
      const btn = ev.target.closest('button'); if(!btn) return;
      const article = btn.closest('article');
      if(btn.classList.contains('detailsBtn')) openDetailModal(article);
      if(btn.classList.contains('buyBtn')) openPurchaseModal(article.getAttribute('data-key'), article.getAttribute('data-price'));
    });

    // modal handlers
    $('closeDetail').addEventListener('click', ()=> $('detailsModal').style.display='none');
    $('detailClose').addEventListener('click', ()=> $('detailsModal').style.display='none');
    $('detailBuy').addEventListener('click', ()=> {
      const k = $('detailTitle').getAttribute('data-key'), p = $('detailTitle').getAttribute('data-price');
      $('detailsModal').style.display='none'; openPurchaseModal(k,p);
    });

    $('closePurchase').addEventListener('click', ()=> $('purchaseModal').style.display='none');
    $('cancelPurchaseBtn').addEventListener('click', ()=> $('purchaseModal').style.display='none');

    $('purchaseForm').addEventListener('submit', e=>{
      e.preventDefault();
      const name = $('buyerName').value.trim(), phone = $('buyerPhone').value.trim();
      if(!name || !phone){ showToast((lang==='te')? '‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞™‡±á‡∞∞‡±Å ‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞´‡±ã‡∞®‡±ç ‡∞á‡∞µ‡±ç‡∞µ‡∞Ç‡∞°‡∞ø.' : 'Please enter name and phone'); return; }
      $('purchaseModal').style.display='none';
      showToast((lang==='te')? '‡∞Æ‡±Ä ‡∞Ö‡∞≠‡±ç‡∞Ø‡∞∞‡±ç‡∞•‡∞® ‡∞Ö‡∞Ç‡∞¶‡±Å‡∞ï‡±Å‡∞Ç‡∞¶‡∞ø ‚Äî ‡∞Æ‡±á‡∞Æ‡±Å ‡∞∏‡∞Ç‡∞™‡±ç‡∞∞‡∞¶‡∞ø‡∞∏‡±ç‡∞§‡∞æ‡∞Æ‡±Å.' : 'Request received ‚Äî we will contact you.');
    });

    function showModels(type){
      $('modelsArea').classList.remove('hidden');
      qsa('#modelsGrid article').forEach(a=> a.style.display = (a.getAttribute('data-type')===type) ? '' : 'none');
      $('tabNew').classList.toggle('primary', type==='new');
      $('tabOld').classList.toggle('primary', type==='old');

      // highlight cheapest visible model
      qsa('#modelsGrid article').forEach(a=>{ a.classList.remove('recommended'); const rb=a.querySelector('.recommend-badge'); if(rb) rb.remove(); });
      const last = window._lastCalc;
      if(last && last.devices){
        const visible = last.devices.find(d => d.card.getAttribute('data-type')===type);
        if(visible){
          const c = visible.card; c.classList.add('recommended');
          const badge = document.createElement('div'); badge.className='recommend-badge'; badge.textContent = `${visible.devicesReq} √ó`;
          c.appendChild(badge); setTimeout(()=> c.scrollIntoView({behavior:'smooth', block:'center'}),120);
        }
      }
    }

    function openDetailModal(article){
      const name = article.querySelector('.model-name').textContent;
      const fans = article.getAttribute('data-fans'), hp = article.getAttribute('data-hp'), price = article.getAttribute('data-price');
      $('detailTitle').textContent = name; $('detailTitle').setAttribute('data-key', article.getAttribute('data-key')); $('detailTitle').setAttribute('data-price', price);
      $('detailSub').textContent = `${fans}-fans ‚Ä¢ ‚âà ${hp} HP ‚Ä¢ ‚Çπ ${price}`;
      const desc = (lang==='te')? (article.querySelector('.model-desc').getAttribute('data-desc-te')||article.querySelector('.model-desc').getAttribute('data-desc-en')) : (article.querySelector('.model-desc').getAttribute('data-desc-en')||article.querySelector('.model-desc').getAttribute('data-desc-te'));
      $('detailBody').innerHTML = `<div style="font-weight:700">${(lang==='te')?'‡∞µ‡∞ø‡∞µ‡∞∞‡∞£':'Description'}</div><div style="margin-top:6px;color:#334155">${escapeHtml(desc)}</div>`;
      $('detailsModal').style.display='flex';
    }

    function openPurchaseModal(key, price){
      $('purchaseModelKey').value = key; $('purchasePrice').value = price||'';
      $('purchaseModal').style.display='flex';
    }

    // set initial mapping text & language from storage
    $('langSel').value = localStorage.getItem('lang') || lang;
    $('langSel').addEventListener('change', ()=> applyLang());
    applyLang();
  });
</script>
</body>
</html>
