<!DOCTYPE html>
<html lang="te">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ఎరేటర్ — Aquaculture A–Z</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { theme: { extend: { boxShadow: { soft:'0 12px 28px rgba(2,6,23,.08)' } } } }
  </script>

  <style>
    html { scroll-behavior:smooth; }
    body { background: linear-gradient(135deg,#e6f3ff 0%,#f0fbf7 100%); font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
    header { position: sticky; top:0; z-index:50; background: white; border-bottom: 1px solid #e6eef6; }
    .btn { display:inline-flex; align-items:center; justify-content:center; gap:.5rem; padding:.6rem .9rem; border-radius: .85rem; font-weight:700; border:1px solid #e6eef6; background:white; }
    .primary { background:#059669; color:#fff; border-color: #059669; }
    .ghost { background:transparent; }
    .card { border-radius: .75rem; overflow:hidden; border:1px solid #e6eef6; background:white; }
    .card-img { width:100%; height:120px; object-fit:cover; display:block; background:#f0f6fb; }
    .fans-pill { display:inline-block; padding:.18rem .45rem; border-radius:999px; font-weight:800; background:#ecfdf5; color:#065f46; margin-right:.5rem; }
    .recommended { outline: 3px solid rgba(16,185,129,.14); box-shadow: 0 8px 26px rgba(16,185,129,0.06); position:relative; }
    .recommend-badge { position:absolute; right:10px; top:10px; background:#059669; color:white; padding:6px 10px; border-radius:999px; font-weight:800; font-size:13px; }
    .hidden { display:none; }
    .container { max-width:1100px; margin:0 auto; padding:14px; }
    @media (min-width: 768px) { .two-col { display:grid; grid-template-columns: 1fr 420px; gap:18px; } }
    @media (max-width: 767px) { .card-img{height:140px} .recommend-badge{font-size:12px;padding:5px 8px} }
  </style>
</head>
<body>

  <!-- Header: only Back + History per request -->
  <header>
    <div class="container flex items-center justify-between py-3">
      <div class="flex items-center gap-3">
        <button id="backBtn" class="btn" title="Back" onclick="history.back()">
          ← వెనక్కి
        </button>
      </div>
      <div>
        <a href="history.html" class="btn ghost" id="historyBtn">చరిత్ర</a>
      </div>
    </div>
  </header>

  <main class="container pt-4 pb-20">

    <!-- Hero / description -->
    <section class="mb-4">
      <div class="card p-4">
        <h1 class="text-xl font-bold">ఎరేటర్</h1>
        <p class="mt-2 text-slate-600">ఎరేటర్లు చెరువులో ఆక్సిజన్ స్థాయిలను నిలుపుకోవడానికి సహాయపడతాయి — క్రింది లెక్కింపు ఉపయోగించి ఎంత సామర్థ్యం కావాలో తెలుసుకోండి.  (ఉపరితల తేలే మోడల్స్ కొరకు)</p>
      </div>
    </section>

    <!-- Main area: calculator (initial) -->
    <section id="calculatorArea" class="card p-4">
      <h2 class="font-semibold mb-3">ఎరేటర్ కేల్క్యులేటర్</h2>

      <label class="text-xs font-medium">చెరువు ఉపరితలం (ఎకరాలు)</label>
      <input id="acreInput" type="number" step="0.01" min="0.01" placeholder="ఉదా. 0.5" class="mt-2 w-full rounded-lg border px-3 py-2" />

      <label class="text-xs font-medium mt-3 block">సగటు లోతు (ఫుట్స్లో)</label>
      <input id="depthFtInput" type="number" step="0.1" min="0.1" placeholder="ఉదా. 4" class="mt-2 w-full rounded-lg border px-3 py-2" />

      <div class="mt-4 flex gap-2">
        <button id="calcBtn" class="btn primary flex-1">లెక్కించు</button>
        <button id="resetBtn" class="btn">రీసెట్</button>
      </div>

      <div id="resultPanel" class="mt-4 hidden">
        <!-- Telugu-only result will be placed here -->
      </div>

      <p class="mt-4 text-xs text-slate-500">గమనిక: ఇది ఒక అంచనా మాత్రమే; ఖచ్చిత ఎంపిక కోసం ఉత్పత్తి స్పెక్స్ చూడండి.</p>
    </section>

    <!-- Models area: will replace calculator when user clicks New/Old OR after calculate -->
    <section id="modelsArea" class="hidden mt-4">
      <div class="flex items-center justify-between mb-3">
        <div class="flex items-center gap-2">
          <button id="showNew" class="btn">కొత్త</button>
          <button id="showOld" class="btn">పాత</button>
        </div>
        <div>
          <button id="backToCalcBtn" class="btn">Back to calculator</button>
        </div>
      </div>

      <div id="modelsGrid" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <!-- New models -->
        <article class="card p-3" data-type="new" data-key="float-2" data-flow="8000" data-power="150" data-price="12000" data-fans="2">
          <img class="card-img" src="assets/float-2.jpg" alt="Floating 2 Fans" onerror="this.style.opacity=.6" />
          <div class="mt-3">
            <div class="flex items-center justify-between">
              <div>
                <span class="fans-pill">2</span>
                <div class="font-bold model-name">తేలే — 2 ఫ్యాన్స్</div>
                <div class="text-xs text-slate-500 mt-1">ఫ్లో: 8000 L/h · శక్తి: 150 W</div>
              </div>
              <div class="font-semibold">₹ 12,000</div>
            </div>
            <p class="mt-2 text-sm text-slate-600">చిన్న చెరువుల కోసం సరసమైనది — 2 ఫ్యాన్స్‌తో ఉపరితల మిశ్రమం అందిస్తుంది.</p>

            <div class="mt-3 flex gap-2">
              <button class="btn detailsBtn flex-1">వివరాలు</button>
              <button class="btn primary buyBtn" data-key="float-2" data-price="12000">కొనండి</button>
            </div>
          </div>
        </article>

        <article class="card p-3" data-type="new" data-key="float-4" data-flow="16000" data-power="300" data-price="22000" data-fans="4">
          <img class="card-img" src="assets/float-4.jpg" alt="Floating 4 Fans" onerror="this.style.opacity=.6" />
          <div class="mt-3">
            <div class="flex items-center justify-between">
              <div>
                <span class="fans-pill">4</span>
                <div class="font-bold model-name">తేలే — 4 ఫ్యాన్స్</div>
                <div class="text-xs text-slate-500 mt-1">ఫ్లో: 16000 L/h · శక్తి: 300 W</div>
              </div>
              <div class="font-semibold">₹ 22,000</div>
            </div>
            <p class="mt-2 text-sm text-slate-600">మధ్యమ చెరువులకు మిక్సింగ్ మరియు శక్తివంతమైన ఉపరితల ఏరేషన్.</p>

            <div class="mt-3 flex gap-2">
              <button class="btn detailsBtn flex-1">వివరాలు</button>
              <button class="btn primary buyBtn" data-key="float-4" data-price="22000">కొనండి</button>
            </div>
          </div>
        </article>

        <article class="card p-3" data-type="new" data-key="float-6" data-flow="24000" data-power="450" data-price="32000" data-fans="6">
          <img class="card-img" src="assets/float-6.jpg" alt="Floating 6 Fans" onerror="this.style.opacity=.6" />
          <div class="mt-3">
            <div class="flex items-center justify-between">
              <div>
                <span class="fans-pill">6</span>
                <div class="font-bold model-name">తేలే — 6 ఫ్యాన్స్</div>
                <div class="text-xs text-slate-500 mt-1">ఫ్లో: 24000 L/h · శక్తి: 450 W</div>
              </div>
              <div class="font-semibold">₹ 32,000</div>
            </div>
            <p class="mt-2 text-sm text-slate-600">పెద్ద చెరువుల కోసం — అధిక సర్క్యులేషన్ మరియు ఆక్సిజనేషన్.</p>

            <div class="mt-3 flex gap-2">
              <button class="btn detailsBtn flex-1">వివరాలు</button>
              <button class="btn primary buyBtn" data-key="float-6" data-price="32000">కొనండి</button>
            </div>
          </div>
        </article>

        <article class="card p-3" data-type="new" data-key="float-8" data-flow="32000" data-power="600" data-price="42000" data-fans="8">
          <img class="card-img" src="assets/float-8.jpg" alt="Floating 8 Fans" onerror="this.style.opacity=.6" />
          <div class="mt-3">
            <div class="flex items-center justify-between">
              <div>
                <span class="fans-pill">8</span>
                <div class="font-bold model-name">తేలే — 8 ఫ్యాన్స్</div>
                <div class="text-xs text-slate-500 mt-1">ఫ్లో: 32000 L/h · శక్తి: 600 W</div>
              </div>
              <div class="font-semibold">₹ 42,000</div>
            </div>
            <p class="mt-2 text-sm text-slate-600">వాణిజ్య చెరువులకు — ఒక్క యూనిట్ నుండి గరిష్ట ఉపరితల ఏరేషన్.</p>

            <div class="mt-3 flex gap-2">
              <button class="btn detailsBtn flex-1">వివరాలు</button>
              <button class="btn primary buyBtn" data-key="float-8" data-price="42000">కొనండి</button>
            </div>
          </div>
        </article>

        <!-- Old / used (hidden until 'పాత' clicked) -->
        <article class="card p-3" data-type="old" data-key="used-2" data-flow="7000" data-power="140" data-price="7500" data-fans="2" style="display:none;">
          <img class="card-img" src="assets/used-2.jpg" alt="Used 2 Fans" onerror="this.style.opacity=.6" />
          <div class="mt-3">
            <div class="flex items-center justify-between">
              <div>
                <span class="fans-pill">2</span>
                <div class="font-bold model-name">రెండవ చేతి — 2 ఫ్యాన్స్</div>
                <div class="text-xs text-slate-500 mt-1">ఫ్లో: 7000 L/h · శక్తి: 140 W</div>
              </div>
              <div class="font-semibold">₹ 7,500</div>
            </div>
            <p class="mt-2 text-sm text-slate-600">సరి చూసిన రెండవ చేతి యూనిట్ — బడ్జెట్ ఆప్షన్.</p>

            <div class="mt-3 flex gap-2">
              <button class="btn detailsBtn flex-1">వివరాలు</button>
              <button class="btn primary buyBtn" data-key="used-2" data-price="7500">కొనండి</button>
            </div>
          </div>
        </article>

        <article class="card p-3" data-type="old" data-key="used-4" data-flow="14000" data-power="280" data-price="13500" data-fans="4" style="display:none;">
          <img class="card-img" src="assets/used-4.jpg" alt="Used 4 Fans" onerror="this.style.opacity=.6" />
          <div class="mt-3">
            <div class="flex items-center justify-between">
              <div>
                <span class="fans-pill">4</span>
                <div class="font-bold model-name">రెండవ చేతి — 4 ఫ్యాన్స్</div>
                <div class="text-xs text-slate-500 mt-1">ఫ్లో: 14000 L/h · శక్తి: 280 W</div>
              </div>
              <div class="font-semibold">₹ 13,500</div>
            </div>
            <p class="mt-2 text-sm text-slate-600">చెక్కించిన & సర్వీస్ చేసిన రెండవ చేతి యూనిట్.</p>

            <div class="mt-3 flex gap-2">
              <button class="btn detailsBtn flex-1">వివరాలు</button>
              <button class="btn primary buyBtn" data-key="used-4" data-price="13500">కొనండి</button>
            </div>
          </div>
        </article>

      </div>
    </section>

  </main>

  <!-- Purchase Modal -->
  <div id="modalOverlay" class="hidden" style="position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.35);z-index:60;">
    <div class="card p-4" style="width:96%;max-width:420px;">
      <div class="flex items-center justify-between">
        <div class="font-semibold">కొనుగోలు</div>
        <button id="closeModal" class="btn">✕</button>
      </div>
      <form id="purchaseForm" class="mt-3 space-y-2">
        <input type="hidden" id="modalModelKey" />
        <input type="hidden" id="modalPrice" />
        <label class="text-xs">పేరు</label>
        <input id="buyerName" class="w-full rounded-lg border px-3 py-2" required />
        <label class="text-xs">ఫోన్</label>
        <input id="buyerPhone" class="w-full rounded-lg border px-3 py-2" required />
        <label class="text-xs">గ్రామం / పట్టణం</label>
        <input id="buyerPlace" class="w-full rounded-lg border px-3 py-2" />
        <div class="mt-3 flex gap-2">
          <button class="btn primary flex-1" type="submit">అభ్యర్థన పంపు</button>
          <button id="cancelPurchase" type="button" class="btn">రద్దు</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Minimal chat placeholder (prefill target) -->
  <div id="chatPrefill" class="hidden"></div>

  <script>
    // Mobile-first single-page aerator logic in Telugu
    (function(){
      const ACRE_TO_M2 = 4046.85642;
      const FT_TO_M = 0.3048;

      const acreInput = document.getElementById('acreInput');
      const depthFtInput = document.getElementById('depthFtInput');
      const calcBtn = document.getElementById('calcBtn');
      const resetBtn = document.getElementById('resetBtn');
      const resultPanel = document.getElementById('resultPanel');
      const calculatorArea = document.getElementById('calculatorArea');

      const modelsArea = document.getElementById('modelsArea');
      const showNewBtn = document.getElementById('showNew');
      const showOldBtn = document.getElementById('showOld');
      const backToCalcBtn = document.getElementById('backToCalcBtn');

      const modalOverlay = document.getElementById('modalOverlay');
      const closeModal = document.getElementById('closeModal');
      const purchaseForm = document.getElementById('purchaseForm');
      const cancelPurchase = document.getElementById('cancelPurchase');
      const modalModelKey = document.getElementById('modalModelKey');
      const modalPrice = document.getElementById('modalPrice');

      const getModelCards = () => Array.from(document.querySelectorAll('#modelsGrid article'));

      function formatNum(n){ return Number(n).toLocaleString('en-IN'); }

      function estimateFromAcresFeet(acres, depthFt) {
        const depthM = depthFt * FT_TO_M;
        const area_m2 = acres * ACRE_TO_M2;
        const volume_m3 = area_m2 * depthM;
        const liters = volume_m3 * 1000;
        // turnover 10% per hour (simple rule), ensure minimum 500 L/h
        const needed_lph = Math.max(500, Math.round(liters * 0.10));
        // compute units for each available model (both new and old)
        const recs = [];
        getModelCards().forEach(card => {
          const key = card.getAttribute('data-key');
          const flow = parseFloat(card.getAttribute('data-flow')) || 0;
          const price = parseFloat(card.getAttribute('data-price')) || 0;
          const fans = card.getAttribute('data-fans') || '?';
          if (flow <= 0) return;
          const units = Math.ceil(needed_lph / flow);
          recs.push({ key, units, flow, price, fans, totalFlow: units * flow, totalPrice: units * price, card });
        });
        recs.sort((a,b) => a.totalPrice - b.totalPrice); // cheapest total price first
        return { area_m2, depth_m: depthM, volume_m3, liters, needed_lph, recommendations: recs };
      }

      function clearHighlights() {
        getModelCards().forEach(c => {
          c.classList.remove('recommended');
          const rb = c.querySelector('.recommend-badge');
          if (rb) rb.remove();
        });
      }

      function highlightBest(best) {
        clearHighlights();
        if (!best) return;
        const card = best.card;
        card.classList.add('recommended');
        const badge = document.createElement('div');
        badge.className = 'recommend-badge';
        badge.textContent = `${best.units} ×`;
        card.appendChild(badge);
        // scroll into view
        setTimeout(()=> card.scrollIntoView({behavior:'smooth', block:'center'}), 120);
      }

      function showResultTelugu(res) {
        // only Telugu result as requested
        const best = res.recommendations[0];
        const lines = [];
        lines.push(`అంచనా చెరువు: ${res.volume_m3.toFixed(2)} m³ (${formatNum(res.liters)} L).`);
        lines.push(`సమగ్ర అవసరం: సుమారు ${formatNum(res.needed_lph)} L/h.`);
        if (best) {
          // show best recommendation summary
          const card = best.card;
          const nameTe = card.querySelector('.model-name') ? card.querySelector('.model-name').textContent : best.key;
          lines.push(`ఉత్తమ ఎంపిక: ${best.units} × ${nameTe} — మొత్తం ఫ్లో ${formatNum(best.totalFlow)} L/h. (మొత్తం ధర ₹${formatNum(best.totalPrice)})`);
        } else {
          lines.push('సరైన మోడల్ లేదు.');
        }

        // also show a compact table of all model unit requirements (fans highlighted)
        let table = `<div class="mt-3">`;
        table += `<div style="font-weight:800;margin-bottom:6px">మోడల్ ప్రకారం అవసరమైన యూనిట్‌లు</div>`;
        table += `<div style="display:grid;gap:8px">`;
        res.recommendations.forEach(r=>{
          const card = r.card;
          const modelName = card.querySelector('.model-name') ? card.querySelector('.model-name').textContent : r.key;
          table += `<div style="display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:10px;background:#f8faf8">`;
          table += `<div><span style="font-weight:800;color:#065f46;margin-right:8px">${r.fans} ఫ్యాన్స్</span> ${modelName}</div>`;
          table += `<div style="text-align:right"><div style="font-weight:800;color:#0b6b3a">${r.units} యూనిట్</div><div style="font-size:13px;color:#334155">(${formatNum(r.totalFlow)} L/h)</div></div>`;
          table += `</div>`;
        });
        table += `</div></div>`;

        // combine
        resultPanel.innerHTML = `<div><div style="font-weight:800">${lines.join(' ')}</div>${table}
          <div class="mt-3" style="display:flex;gap:8px">
            <button id="viewModelsBtn" class="btn">మోడల్స్ చూపించు</button>
            <button id="selectBestBtn" class="btn primary">ఎంచుకో & కోట్ అడగు</button>
          </div>
        </div>`;
        resultPanel.classList.remove('hidden');

        // highlight best
        highlightBest(best);

        // wiring for buttons
        document.getElementById('viewModelsBtn').addEventListener('click', ()=> {
          showModels('new'); // show new models by default
        });
        document.getElementById('selectBestBtn').addEventListener('click', ()=> {
          // open buy modal prefilled for best
          if (!best) return;
          openBuyModal(best.card.getAttribute('data-key'), best.totalPrice || best.card.getAttribute('data-price'));
        });
      }

      // show models section (type: 'new' or 'old')
      function showModels(type) {
        calculatorArea.classList.add('hidden');
        modelsArea.classList.remove('hidden');
        // show only cards of this type
        getModelCards().forEach(c=>{
          if (c.getAttribute('data-type') === type) {
            c.style.display = '';
          } else {
            c.style.display = 'none';
          }
        });
        // mark active button
        showNewBtn.classList.toggle('primary', type === 'new');
        showOldBtn.classList.toggle('primary', type === 'old');
        // clear previous recommend highlight (we will keep if already set)
      }

      function backToCalculator() {
        modelsArea.classList.add('hidden');
        calculatorArea.classList.remove('hidden');
      }

      // Buy modal helpers
      function openBuyModal(key, price) {
        modalModelKey.value = key;
        modalPrice.value = price || '';
        modalOverlay.classList.remove('hidden');
      }
      function closeBuyModal() {
        modalOverlay.classList.add('hidden');
      }

      // Details button show simple alert in Telugu + English (user earlier accepted simple modal)
      function showDetails(card) {
        const flow = card.getAttribute('data-flow');
        const power = card.getAttribute('data-power');
        const fans = card.getAttribute('data-fans');
        const name = card.querySelector('.model-name') ? card.querySelector('.model-name').textContent : card.getAttribute('data-key');
        const te = `మోడల్: ${name}\nఫ్లో: ${flow} L/h\nశక్తి: ${power} W\nఫ్యాన్స్: ${fans}`;
        const en = `Model: ${name}\nFlow: ${flow} L/h\nPower: ${power} W\nFans: ${fans}`;
        alert(te + "\n\n" + en);
      }

      // events
      calcBtn.addEventListener('click', ()=> {
        const acres = parseFloat(acreInput.value) || 0;
        const depthFt = parseFloat(depthFtInput.value) || 0;
        if (acres <= 0 || depthFt <= 0) {
          alert('దయచేసి సరైన విలువలు ఇవ్వండి (ఎకరాలు మరియు ఫుట్స్).');
          return;
        }
        const res = estimateFromAcresFeet(acres, depthFt);
        showResultTelugu(res);
      });

      resetBtn.addEventListener('click', ()=> {
        acreInput.value = '';
        depthFtInput.value = '';
        resultPanel.classList.add('hidden');
        resultPanel.innerHTML = '';
        clearHighlights();
        backToCalculator();
      });

      // show new/old buttons behavior
      showNewBtn.addEventListener('click', ()=> showModels('new'));
      showOldBtn.addEventListener('click', ()=> showModels('old'));
      backToCalcBtn.addEventListener('click', ()=> backToCalculator());

      // delegation for details and buy inside models
      document.getElementById('modelsGrid').addEventListener('click', (e) => {
        const btn = e.target.closest('button');
        if (!btn) return;
        if (btn.classList.contains('detailsBtn')) {
          const card = btn.closest('article');
          showDetails(card);
          return;
        }
        if (btn.classList.contains('buyBtn')) {
          const card = btn.closest('article');
          const key = card.getAttribute('data-key');
          const price = card.getAttribute('data-price');
          openBuyModal(key, price);
          return;
        }
      });

      // modal handlers
      closeModal.addEventListener('click', closeBuyModal);
      cancelPurchase.addEventListener('click', closeBuyModal);
      purchaseForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const name = document.getElementById('buyerName').value.trim();
        const phone = document.getElementById('buyerPhone').value.trim();
        const place = document.getElementById('buyerPlace').value.trim();
        if (!name || !phone) { alert('దయచేసి పేరు మరియు ఫోన్ నంబర్ ఇవ్వండి.'); return; }
        const key = modalModelKey.value;
        const price = modalPrice.value;
        // Prefill simple chat text into hidden element (you can hook this to actual chat or mail)
        const card = getModelCards().find(c => c.getAttribute('data-key') === key);
        const modelName = card ? (card.querySelector('.model-name').textContent) : key;
        const en = `Purchase request: ${modelName} (${price ? '₹'+price : ''}). Buyer: ${name}, Phone: ${phone}, Place: ${place || '-'}.`;
        const te = `కొనుగోలు అభ్యర్థన: ${modelName} (${price ? '₹'+price : ''}). కొనుగోలు దారుడు: ${name}, ఫోన్: ${phone}, స్థలం: ${place || '-'}.`;
        // put into chatPrefill so you can copy/paste or trigger an actual chat/send later
        document.getElementById('chatPrefill').textContent = en + "\n" + te;
        alert('అభ్యర్థన చాట్లో ప్రిఫిల్ అయింది. మేము త్వరలో మీతో సంప్రదిస్తాము.\n\n' + te);
        closeBuyModal();
      });

      // initial: only calculator visible (already)
    })();
  </script>
</body>
</html>
