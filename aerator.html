<!DOCTYPE html>
<html lang="te">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Aquaculture A‚ÄìZ ‚Ä¢ Aerator</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { darkMode: 'class', theme: { extend: { boxShadow: { soft: '0 12px 28px rgba(2,6,23,.08)' } } } };
  </script>

  <style>
    html { scroll-behavior:smooth; }
    body { background: linear-gradient(135deg,#dbeafe 0%,#e0f2fe 50%,#f0fdf4 100%); }
    .dark body { background: linear-gradient(135deg,#0f172a 0%,#082f49 50%,#14532d 100%); }
    .navbtn { border:1px solid rgb(226,232,240); padding:.55rem .9rem; border-radius:.75rem; background:#fff; text-align:center; font-weight:700; font-size:1rem; white-space:nowrap; }
    .dark .navbtn { background:#0b1220; border-color:#1f2937; color:#fff; }
    .shadow-soft { box-shadow: 0 12px 28px rgba(2,6,23,.06); }
    .tab { padding: .45rem .9rem; border-radius: 999px; cursor: pointer; border: 1px solid transparent; }
    .tab.active { background: #0b6b6b; color: #fff; border-color: #0b6b6b; }
    .card-img { height:120px; width:100%; object-fit:cover; border-top-left-radius:0.5rem; border-top-right-radius:0.5rem; }
    .card { border-radius:.75rem; overflow:hidden; }
    .card-body { padding:1rem; }
    /* chat */
    .chat-btn { position: fixed; right: 16px; bottom: 78px; width: 56px; height: 56px; border-radius: 50%; background: #0b6b6b; color: #fff; display: flex; align-items: center; justify-content: center; box-shadow: 0 6px 18px rgba(11,107,107,0.18); border: none; z-index: 2000; font-size: 20px; }
    .chat-panel { position: fixed; right: 14px; bottom: 148px; width: 92%; max-width: 360px; height: 56vh; max-height: 520px; background: #fff; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.12); display: none; flex-direction: column; overflow: hidden; z-index: 2000; }
    .chat-panel.open { display: flex; }
    .chat-messages { flex:1; padding:12px; overflow:auto; display:flex;flex-direction:column; gap:8px; background:#fbfbfb; }
    .msg { max-width:78%; padding:8px 10px; border-radius:10px; font-size:14px; }
    .msg.user { align-self:flex-end; background:#0b6b6b; color:#fff; }
    .msg.bot { align-self:flex-start; background:#fff; color:#111; border:1px solid #eee; }
    .reply-en { font-weight:700; margin-bottom:4px; }
    .reply-te { color:#475569; font-size:13px; opacity:0.95; }

    /* modal */
    .modal-overlay { position: fixed; inset:0; background: rgba(0,0,0,0.35); display:none; align-items:center; justify-content:center; z-index:3000; }
    .modal-overlay.open { display:flex; }

    @media(max-width:420px){ .chat-panel{ right:8px; left:8px; max-width:none } .card-img{height:110px} }
  </style>
</head>
<body class="text-slate-900 dark:text-slate-100">

  <!-- Header -->
  <header class="sticky top-0 z-40 backdrop-blur bg-white/80 dark:bg-slate-950/70 border-b border-slate-200 dark:border-slate-800">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center">
      <div class="flex items-center gap-3">
        <div class="h-9 w-9">
          <img src="assets/logo.png" alt="Logo" class="h-9 w-9 object-contain block dark:hidden">
          <img src="assets/logo-dark.png" alt="Logo" class="h-9 w-9 object-contain hidden dark:block">
        </div>
        <h1 class="text-xl font-bold">Aquaculture A‚ÄìZ</h1>
      </div>

      <nav class="ml-auto hidden sm:flex gap-3">
        <a href="index.html" class="navbtn">üè† <span data-i18n="m_home">Home</span></a>
        <a href="aerator.html" class="navbtn">‚öôÔ∏è <span data-i18n="m_aerator">Aerator</span></a>
        <a href="history.html" class="navbtn">üìú <span data-i18n="m_history">History</span></a>
      </nav>

      <div class="ml-4 flex items-center gap-2">
        <label for="langSel" class="text-sm select-none">Ln</label>
        <select id="langSel" class="text-sm border rounded-md px-2 py-1 dark:bg-slate-900 dark:border-slate-700">
          <option value="te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</option>
          <option value="en">English</option>
        </select>
        <button id="themeToggle" class="rounded-full px-3 py-1.5 text-sm border">üåô/‚òÄÔ∏è</button>
      </div>
    </div>
  </header>

  <main class="max-w-7xl mx-auto p-4 space-y-4 pb-40">

    <!-- Hero + tabs -->
    <section class="rounded-2xl p-4 bg-white dark:bg-slate-900 shadow-soft border">
      <div class="flex items-start justify-between gap-4">
        <div>
          <h2 class="text-lg font-semibold flex items-center gap-2">‚öôÔ∏è <span data-i18n="m_aerator">Aerator</span></h2>
          <p class="mt-2 text-slate-600 dark:text-slate-300" data-i18n="aerator_desc">Aerators help maintain oxygen levels in ponds ‚Äî models, power and maintenance guidance shown below.</p>
        </div>

        <div class="flex items-center gap-2">
          <div id="tabNew" class="tab active" role="button" aria-pressed="true" data-sub="new" data-i18n="tab_new">New</div>
          <div id="tabOld" class="tab" role="button" aria-pressed="false" data-sub="old" data-i18n="tab_old">Old</div>
        </div>
      </div>
    </section>

    <!-- Main: calculator (left) + models (right) -->
    <section class="grid grid-cols-1 lg:grid-cols-2 gap-4">
      <!-- Calculator (ACRES + DEPTH IN FEET) -->
      <div class="rounded-xl p-4 bg-slate-50 dark:bg-slate-800/40 border">
        <h3 class="font-semibold mb-2" data-i18n="calc_title">Aerator Calculator</h3>

        <label class="text-xs font-medium" for="pondArea" data-i18n="calc_area_label">Pond area (acres)</label>
        <input id="pondArea" type="number" min="0.01" step="0.01" placeholder="eg. 0.5" class="mt-1 w-full rounded-md border px-3 py-2 dark:bg-slate-900" />

        <label class="text-xs font-medium mt-3 block" for="pondDepthFt" data-i18n="calc_depth_label_ft">Average depth (ft)</label>
        <input id="pondDepthFt" type="number" min="0.1" step="0.1" placeholder="eg. 4" class="mt-1 w-full rounded-md border px-3 py-2 dark:bg-slate-900" />

        <div class="mt-3 flex items-center gap-2">
          <button id="calcBtn" class="navbtn flex-1" data-i18n="calc_btn">Calculate</button>
          <button id="calcReset" class="navbtn bg-white/60" data-i18n="calc_reset">Reset</button>
        </div>

        <div id="calcResult" class="mt-3 text-sm text-slate-700 dark:text-slate-200 hidden" aria-live="polite"></div>
        <p class="mt-3 text-xs text-slate-500" data-i18n="calc_note">Note: This is an estimate; consult product specs for exact selection.</p>
      </div>

      <!-- Models area (cards with image top, details + buy) -->
      <div id="modelsArea" class="space-y-4">
        <div id="modelsGrid" class="grid grid-cols-1 sm:grid-cols-2 gap-3">

          <!-- Floating 2 Fans -->
          <article class="card bg-white dark:bg-slate-900 border" data-sub="new" data-model-key="float-2">
            <img class="card-img" src="assets/float-2.jpg" alt="Floating 2 Fans" onerror="this.style.opacity=.6" />
            <div class="card-body">
              <div class="flex items-start justify-between">
                <div>
                  <div class="font-semibold">Floating ‚Äî 2 Fans</div>
                  <div class="text-xs text-slate-500 mt-1" data-i18n="model_flow">Flow: 8,000 L/h ¬∑ Power: 150 W</div>
                </div>
                <div class="text-sm font-bold">‚Çπ 12,000</div>
              </div>
              <p class="mt-2 text-sm text-slate-600 dark:text-slate-300 model-desc" data-i18n="model_desc_float2">Surface floating type ‚Äî economical for small ponds; 2 fans provide gentle circulation.</p>

              <div class="mt-3 flex gap-2">
                <button class="navbtn btn-details flex-1" data-specs='{"flow":"8000 L/h","power":"150W","fans":2}' data-model="Floating 2Fans">Details</button>
                <button class="navbtn bg-emerald-50 text-emerald-800 btn-buy" data-model="Floating 2Fans" data-price="12000">Buy</button>
              </div>
            </div>
          </article>

          <!-- Floating 4 Fans -->
          <article class="card bg-white dark:bg-slate-900 border" data-sub="new" data-model-key="float-4">
            <img class="card-img" src="assets/float-4.jpg" alt="Floating 4 Fans" onerror="this.style.opacity=.6" />
            <div class="card-body">
              <div class="flex items-start justify-between">
                <div>
                  <div class="font-semibold">Floating ‚Äî 4 Fans</div>
                  <div class="text-xs text-slate-500 mt-1" data-i18n="model_flow">Flow: 16,000 L/h ¬∑ Power: 300 W</div>
                </div>
                <div class="text-sm font-bold">‚Çπ 22,000</div>
              </div>
              <p class="mt-2 text-sm text-slate-600 dark:text-slate-300 model-desc" data-i18n="model_desc_float4">Best for medium ponds ‚Äî stronger surface aeration and mixing.</p>

              <div class="mt-3 flex gap-2">
                <button class="navbtn btn-details flex-1" data-specs='{"flow":"16000 L/h","power":"300W","fans":4}' data-model="Floating 4Fans">Details</button>
                <button class="navbtn bg-emerald-50 text-emerald-800 btn-buy" data-model="Floating 4Fans" data-price="22000">Buy</button>
              </div>
            </div>
          </article>

          <!-- Floating 6 Fans -->
          <article class="card bg-white dark:bg-slate-900 border" data-sub="new" data-model-key="float-6">
            <img class="card-img" src="assets/float-6.jpg" alt="Floating 6 Fans" onerror="this.style.opacity=.6" />
            <div class="card-body">
              <div class="flex items-start justify-between">
                <div>
                  <div class="font-semibold">Floating ‚Äî 6 Fans</div>
                  <div class="text-xs text-slate-500 mt-1" data-i18n="model_flow">Flow: 24,000 L/h ¬∑ Power: 450 W</div>
                </div>
                <div class="text-sm font-bold">‚Çπ 32,000</div>
              </div>
              <p class="mt-2 text-sm text-slate-600 dark:text-slate-300 model-desc" data-i18n="model_desc_float6">For larger ponds ‚Äî high circulation and oxygenation.</p>

              <div class="mt-3 flex gap-2">
                <button class="navbtn btn-details flex-1" data-specs='{"flow":"24000 L/h","power":"450W","fans":6}' data-model="Floating 6Fans">Details</button>
                <button class="navbtn bg-emerald-50 text-emerald-800 btn-buy" data-model="Floating 6Fans" data-price="32000">Buy</button>
              </div>
            </div>
          </article>

          <!-- Floating 8 Fans -->
          <article class="card bg-white dark:bg-slate-900 border" data-sub="new" data-model-key="float-8">
            <img class="card-img" src="assets/float-8.jpg" alt="Floating 8 Fans" onerror="this.style.opacity=.6" />
            <div class="card-body">
              <div class="flex items-start justify-between">
                <div>
                  <div class="font-semibold">Floating ‚Äî 8 Fans</div>
                  <div class="text-xs text-slate-500 mt-1" data-i18n="model_flow">Flow: 32,000 L/h ¬∑ Power: 600 W</div>
                </div>
                <div class="text-sm font-bold">‚Çπ 42,000</div>
              </div>
              <p class="mt-2 text-sm text-slate-600 dark:text-slate-300 model-desc" data-i18n="model_desc_float8">Commercial ponds ‚Äî maximum surface aeration from single unit.</p>

              <div class="mt-3 flex gap-2">
                <button class="navbtn btn-details flex-1" data-specs='{"flow":"32000 L/h","power":"600W","fans":8}' data-model="Floating 8Fans">Details</button>
                <button class="navbtn bg-emerald-50 text-emerald-800 btn-buy" data-model="Floating 8Fans" data-price="42000">Buy</button>
              </div>
            </div>
          </article>

          <!-- OLD: used items -->
          <article class="card bg-white dark:bg-slate-900 border" data-sub="old" style="display:none;">
            <img class="card-img" src="assets/used-2.jpg" alt="Used 2 Fans" onerror="this.style.opacity=.6" />
            <div class="card-body">
              <div class="flex items-start justify-between">
                <div>
                  <div class="font-semibold">Used ‚Äî 2 Fans</div>
                  <div class="text-xs text-slate-500 mt-1" data-i18n="model_flow">Flow: 7,000 L/h ¬∑ Power: 140 W</div>
                </div>
                <div class="text-sm font-bold">‚Çπ 7,500</div>
              </div>
              <p class="mt-2 text-sm text-slate-600 dark:text-slate-300 model-desc" data-i18n="model_desc_used2">Second-hand, checked; warranty limited ‚Äî economical option.</p>

              <div class="mt-3 flex gap-2">
                <button class="navbtn btn-details flex-1" data-specs='{"flow":"7000 L/h","power":"140W","fans":2}' data-model="Used 2Fans">Details</button>
                <button class="navbtn bg-amber-50 text-amber-800 btn-buy" data-model="Used 2Fans" data-price="7500">Buy</button>
              </div>
            </div>
          </article>

          <article class="card bg-white dark:bg-slate-900 border" data-sub="old" style="display:none;">
            <img class="card-img" src="assets/used-4.jpg" alt="Used 4 Fans" onerror="this.style.opacity=.6" />
            <div class="card-body">
              <div class="flex items-start justify-between">
                <div>
                  <div class="font-semibold">Used ‚Äî 4 Fans</div>
                  <div class="text-xs text-slate-500 mt-1" data-i18n="model_flow">Flow: 14,000 L/h ¬∑ Power: 280 W</div>
                </div>
                <div class="text-sm font-bold">‚Çπ 13,500</div>
              </div>
              <p class="mt-2 text-sm text-slate-600 dark:text-slate-300 model-desc" data-i18n="model_desc_used4">Checked & serviced ‚Äî good for medium ponds on budget.</p>

              <div class="mt-3 flex gap-2">
                <button class="navbtn btn-details flex-1" data-specs='{"flow":"14000 L/h","power":"280W","fans":4}' data-model="Used 4Fans">Details</button>
                <button class="navbtn bg-amber-50 text-amber-800 btn-buy" data-model="Used 4Fans" data-price="13500">Buy</button>
              </div>
            </div>
          </article>

        </div>

        <!-- FAQs -->
        <div class="rounded-xl p-3 bg-slate-50 dark:bg-slate-800/40 border">
          <div class="font-semibold" data-i18n="faq_title">FAQs</div>
          <ul class="mt-2 text-sm text-slate-600 dark:text-slate-300 space-y-1">
            <li><strong data-i18n="faq_q1">How often to maintain?</strong> <span data-i18n="faq_a1">Monthly check & cleaning recommended.</span></li>
            <li><strong data-i18n="faq_q2">Power consumption?</strong> <span data-i18n="faq_a2">See model specs ‚Äî typical range 140W‚Äì600W.</span></li>
          </ul>
        </div>

      </div>
    </section>
  </main>

  <!-- Bottom nav -->
  <nav class="fixed bottom-0 inset-x-0 bg-white dark:bg-slate-900 border-t border-slate-200 dark:border-slate-700 flex justify-around py-2 z-40 sm:hidden" style="padding-bottom: env(safe-area-inset-bottom);">
    <a href="index.html" class="flex flex-col items-center text-base font-semibold"><span>üè†</span><span data-i18n="m_home">Home</span></a>
    <a href="aerator.html" class="flex flex-col items-center text-base font-semibold"><span>‚öôÔ∏è</span><span data-i18n="m_aerator">Aerator</span></a>
    <a href="history.html" class="flex flex-col items-center text-base font-semibold"><span>üïò</span><span data-i18n="m_history">History</span></a>
  </nav>

  <!-- Chat -->
  <button class="chat-btn" id="openChat" aria-label="Open chat">üí¨</button>
  <div class="chat-panel" id="chatPanel" role="dialog" aria-label="Chat with Aqua A-Z">
    <div class="chat-header">
      <div class="chat-title" id="chatTitle" data-i18n="chat_title">Help & Chat</div>
      <button id="closeChat" aria-label="Close chat" style="background:none;border:none;font-size:18px;padding:6px;cursor:pointer">‚úï</button>
    </div>
    <div class="chat-messages" id="chatMessages" aria-live="polite"></div>
    <div class="chat-input" role="form" aria-label="Chat input">
      <input id="chatInput" type="text" placeholder="Type a message..." aria-label="Type a message" />
      <button id="sendBtn" aria-label="Send message">Send</button>
    </div>
  </div>

  <!-- Purchase Modal -->
  <div class="modal-overlay" id="modalOverlay" aria-hidden="true">
    <div class="bg-white dark:bg-slate-900 rounded-xl w-full max-w-md p-4 shadow-soft">
      <div class="flex items-center justify-between">
        <h3 class="font-semibold">Buy ‚Äî <span id="modalModel">Model</span></h3>
        <button id="modalClose" aria-label="Close" style="background:none;border:none;font-size:18px">‚úï</button>
      </div>

      <form id="purchaseForm" class="mt-3 space-y-2">
        <input type="hidden" id="purchaseModel" name="model" />
        <input type="hidden" id="purchasePrice" name="price" />

        <label class="text-xs">Name</label>
        <input id="buyerName" class="w-full rounded-md border px-3 py-2" required />

        <label class="text-xs">Phone</label>
        <input id="buyerPhone" class="w-full rounded-md border px-3 py-2" required />

        <label class="text-xs">Village / City</label>
        <input id="buyerPlace" class="w-full rounded-md border px-3 py-2" />

        <div class="flex items-center gap-2 mt-2">
          <button id="purchaseSubmit" class="navbtn flex-1">Request Purchase</button>
          <button id="purchaseCancel" type="button" class="navbtn bg-white/60">Cancel</button>
        </div>
        <p class="text-xs text-slate-500 mt-2" data-i18n="purchase_note">We will contact you to confirm price and delivery. (Demo flow)</p>
      </form>
    </div>
  </div>

  <script>
    /***********************
     * i18n defaults
     ***********************/
    window.dict = window.dict || {};
    window.dict.en = window.dict.en || {
      m_aerator:"Aerator", m_home:"Home", m_history:"History",
      calc_title:"Aerator Calculator", calc_area_label:"Pond area (acres)", calc_depth_label_ft:"Average depth (ft)",
      calc_btn:"Calculate", calc_reset:"Reset", calc_note:"Note: This is an estimate; consult product specs for exact selection.",
      tab_new:"New", tab_old:"Old",
      model_flow:"Flow: {flow} ¬∑ Power: {power}",
      model_desc_float2:"Surface floating type ‚Äî economical for small ponds; 2 fans provide gentle circulation.",
      model_desc_float4:"Best for medium ponds ‚Äî stronger surface aeration and mixing.",
      model_desc_float6:"For larger ponds ‚Äî high circulation and oxygenation.",
      model_desc_float8:"Commercial ponds ‚Äî maximum surface aeration from single unit.",
      model_desc_used2:"Second-hand, checked; warranty limited ‚Äî economical option.",
      model_desc_used4:"Checked & serviced ‚Äî good for medium ponds on budget.",
      faq_title:"FAQs", faq_q1:"How often to maintain?", faq_a1:"Monthly check & cleaning recommended.", faq_q2:"Power consumption?", faq_a2:"See model specs ‚Äî typical range 140W‚Äì600W.",
      chat_title:"Help & Chat", chat_greeting:"Hi! How can I help you today?", chat_placeholder:"Type a message...", chat_open_aria:"Open chat", chat_close_aria:"Close chat",
      chat_reply_default:"Sorry, I cannot perform that now; but I can help. Please give more details.",
      chat_reply_aerator:"What details about aerators do you need? Model, capacity, or services?",
      chat_more_info:"Please type a more detailed message.",
      purchase_note:"We will contact you to confirm price and delivery. (Demo flow)",
      purchase_request_subject:"Purchase request"
    };
    window.dict.te = window.dict.te || {
      m_aerator:"‡∞é‡∞∞‡±á‡∞ü‡∞∞‡±ç", m_home:"‡∞π‡±ã‡∞Æ‡±ç", m_history:"‡∞ö‡∞∞‡∞ø‡∞§‡±ç‡∞∞",
      calc_title:"‡∞é‡∞∞‡±á‡∞ü‡∞∞‡±ç ‡∞ï‡±á‡∞≤‡±ç‡∞ï‡±ç‡∞Ø‡±Å‡∞≤‡±á‡∞ü‡∞∞‡±ç", calc_area_label:"‡∞ö‡±Ü‡∞∞‡±Å‡∞µ‡±Å ‡∞â‡∞™‡∞∞‡∞ø‡∞§‡∞≤‡∞Ç (‡∞é‡∞ï‡∞∞‡∞æ‡∞≤‡±Å)", calc_depth_label_ft:"‡∞∏‡∞ó‡∞ü‡±Å ‡∞≤‡±ã‡∞§‡±Å (‡∞´‡±Å‡∞ü‡±ç)",
      calc_btn:"‡∞≤‡±Ü‡∞ï‡±ç‡∞ï‡∞ø‡∞Ç‡∞ö‡±Å", calc_reset:"‡∞∞‡±Ä‡∞∏‡±Ü‡∞ü‡±ç", calc_note:"‡∞ó‡∞Æ‡∞®‡∞ø‡∞ï: ‡∞á‡∞¶‡∞ø ‡∞í‡∞ï ‡∞Ö‡∞Ç‡∞ö‡∞®‡∞æ ‡∞Æ‡∞æ‡∞§‡±ç‡∞∞‡∞Æ‡±á; ‡∞ñ‡∞ö‡±ç‡∞ö‡∞ø‡∞§ ‡∞é‡∞Ç‡∞™‡∞ø‡∞ï ‡∞ï‡±ã‡∞∏‡∞Ç ‡∞â‡∞§‡±ç‡∞™‡∞§‡±ç‡∞§‡∞ø ‡∞µ‡∞ø‡∞µ‡∞∞‡∞æ‡∞≤‡±Å ‡∞™‡∞∞‡∞ø‡∞∂‡±Ä‡∞≤‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø.",
      tab_new:"‡∞ï‡±ä‡∞§‡±ç‡∞§", tab_old:"‡∞™‡∞æ‡∞§",
      model_flow:"‡∞´‡±ç‡∞≤‡±ã: {flow} ¬∑ ‡∞∂‡∞ï‡±ç‡∞§‡∞ø: {power}",
      model_desc_float2:"‡∞™‡±à‡∞® ‡∞§‡±á‡∞≤‡±á ‡∞∞‡∞ï‡∞Ç ‚Äî ‡∞ö‡∞ø‡∞®‡±ç‡∞® ‡∞ö‡±Ü‡∞∞‡±Å‡∞µ‡±Å‡∞≤‡∞ï‡±Å ‡∞∏‡∞∞‡∞∏‡∞Æ‡±à‡∞®‡∞¶‡∞ø; 2 ‡∞´‡±ç‡∞Ø‡∞æ‡∞®‡±ç‡∞∏‡±ç‚Äå‡∞®‡±Å ‡∞ï‡∞≤‡∞ø‡∞ó‡∞ø ‡∞∏‡±Å‡∞®‡±ç‡∞®‡∞ø‡∞§ ‡∞ö‡∞≤‡∞®‡∞Ç ‡∞á‡∞∏‡±ç‡∞§‡±Å‡∞Ç‡∞¶‡∞ø.",
      model_desc_float4:"‡∞Æ‡∞ß‡±ç‡∞Ø‡∞Æ ‡∞ö‡±Ü‡∞∞‡±Å‡∞µ‡±Å‡∞≤ ‡∞ï‡±ã‡∞∏‡∞Ç ‡∞â‡∞§‡±ç‡∞§‡∞Æ‡∞Ç ‚Äî ‡∞∂‡∞ï‡±ç‡∞§‡∞ø‡∞µ‡∞Ç‡∞§‡∞Æ‡±à‡∞® ‡∞â‡∞™‡∞∞‡∞ø‡∞§‡∞≤ ‡∞è‡∞∞‡±á‡∞∑‡∞®‡±ç.",
      model_desc_float6:"‡∞™‡±Ü‡∞¶‡±ç‡∞¶ ‡∞ö‡±Ü‡∞∞‡±Å‡∞µ‡±Å‡∞≤ ‡∞ï‡±ã‡∞∏‡∞Ç ‚Äî ‡∞Ö‡∞ß‡∞ø‡∞ï ‡∞∂‡∞ï‡±ç‡∞§‡∞ø ‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞Ü‡∞ï‡±ç‡∞∏‡∞ø‡∞ú‡∞®‡±á‡∞∑‡∞®‡±ç.",
      model_desc_float8:"‡∞µ‡∞æ‡∞£‡∞ø‡∞ú‡±ç‡∞Ø ‡∞ö‡±Ü‡∞∞‡±Å‡∞µ‡±Å‡∞≤‡∞ï‡±Å ‚Äî ‡∞í‡∞ï‡±á ‡∞Ø‡±Ç‡∞®‡∞ø‡∞ü‡±ç ‡∞®‡±Å‡∞Ç‡∞°‡∞ø ‡∞ó‡∞∞‡∞ø‡∞∑‡±ç‡∞ü ‡∞â‡∞™‡∞∞‡∞ø‡∞§‡∞≤ ‡∞è‡∞∞‡±á‡∞∑‡∞®‡±ç.",
      model_desc_used2:"‡∞∞‡±Ü‡∞Ç‡∞°‡∞µ ‡∞ö‡±á‡∞§‡∞ø,‡∞ö‡±Ü‡∞ï‡±ç ‡∞ö‡±á‡∞Ø‡∞¨‡∞°‡∞ø‡∞®‡∞¶‡∞ø; ‡∞µ‡∞æ‡∞∞‡∞Ç‡∞ü‡±Ä ‡∞™‡∞∞‡∞ø‡∞Æ‡∞ø‡∞§‡∞ø ‚Äî ‡∞∏‡∞∞‡∞∏‡∞Æ‡±à‡∞® ‡∞é‡∞Ç‡∞™‡∞ø‡∞ï.",
      model_desc_used4:"‡∞∏‡∞∞‡±ç‡∞µ‡±Ä‡∞∏‡±ç ‡∞ö‡±á‡∞∏‡∞ø‡∞®‡∞¶‡∞ø ‚Äî ‡∞¨‡∞°‡±ç‡∞ú‡±Ü‡∞ü‡±ç‚Äå‡∞™‡±à ‡∞Æ‡∞ß‡±ç‡∞Ø‡∞Æ ‡∞ö‡±Ü‡∞∞‡±Å‡∞µ‡±Å‡∞≤‡∞ï‡±Å ‡∞¨‡∞æ‡∞ó‡±Å‡∞Ç‡∞¶‡∞ø.",
      faq_title:"‡∞™‡±ç‡∞∞‡∞∂‡±ç‡∞®‡∞≤ ‡∞ú‡∞µ‡∞æ‡∞¨‡±Å‡∞≤‡±Å", faq_q1:"‡∞é‡∞®‡±ç‡∞®‡∞ø ‡∞∏‡∞æ‡∞∞‡±ç‡∞≤‡±Å ‡∞®‡∞ø‡∞∞‡±ç‡∞µ‡∞π‡∞ø‡∞Ç‡∞ö‡∞æ‡∞≤‡∞ø?", faq_a1:"‡∞Æ‡∞æ‡∞∏‡∞™‡∞∞‡±ç‡∞Ø‡∞µ‡±á‡∞ï‡±ç‡∞∑‡∞£ & ‡∞∂‡±Å‡∞≠‡±ç‡∞∞‡∞™‡∞∞‡∞ø‡∞ö‡±Å‡∞ï‡±ã‡∞µ‡∞°‡∞Ç ‡∞∏‡∞ø‡∞´‡∞æ‡∞∞‡±ç‡∞∏‡±Å.", faq_q2:"‡∞∂‡∞ï‡±ç‡∞§‡∞ø ‡∞µ‡∞ø‡∞®‡∞ø‡∞Ø‡±ã‡∞ó‡∞Ç?", faq_a2:"‡∞Æ‡±ã‡∞°‡∞≤‡±ç ‡∞∏‡±ç‡∞™‡±Ü‡∞ï‡±ç‡∞∏‡±ç ‡∞ö‡±Ç‡∞°‡∞Ç‡∞°‡∞ø ‚Äî ‡∞∏‡∞ó‡∞ü‡±Å ‡∞∂‡±ç‡∞∞‡±á‡∞£‡∞ø 140W‚Äì600W.",
      chat_title:"‡∞∏‡∞π‡∞æ‡∞Ø‡∞Ç & ‡∞ö‡∞æ‡∞ü‡±ç", chat_greeting:"‡∞π‡∞æ‡∞Ø‡±ç! ‡∞®‡±á‡∞®‡±Å ‡∞à‡∞∞‡±ã‡∞ú‡±Å ‡∞é‡∞≤‡∞æ ‡∞∏‡∞π‡∞æ‡∞Ø‡∞Ç ‡∞ö‡±á‡∞Ø‡∞ó‡∞≤‡∞®‡±Å?", chat_placeholder:"‡∞Æ‡±Ä ‡∞∏‡∞Ç‡∞¶‡±á‡∞∂‡∞Ç ‡∞∞‡∞æ‡∞Ø‡∞Ç‡∞°‡∞ø...", chat_open_aria:"‡∞ö‡∞æ‡∞ü‡±ç ‡∞ì‡∞™‡±Ü‡∞®‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø", chat_close_aria:"‡∞ö‡∞æ‡∞ü‡±ç ‡∞Æ‡±Ç‡∞∏‡∞ø‡∞µ‡±á‡∞Ø‡∞Ç‡∞°‡∞ø",
      chat_reply_default:"‡∞ï‡±ç‡∞∑‡∞Æ‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø, ‡∞®‡±á‡∞®‡±Å ‡∞¶‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞á‡∞™‡±ç‡∞™‡±Å‡∞°‡±á ‡∞ö‡±á‡∞Ø‡∞≤‡±á‡∞®‡±Å; ‡∞ï‡∞æ‡∞®‡±Ä ‡∞∏‡∞π‡∞æ‡∞Ø‡∞™‡∞°‡∞ó‡∞≤‡∞®‡±Å. ‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞Æ‡∞∞‡∞ø‡∞®‡±ç‡∞®‡∞ø ‡∞µ‡∞ø‡∞µ‡∞∞‡∞æ‡∞≤‡±Å ‡∞á‡∞µ‡±ç‡∞µ‡∞Ç‡∞°‡∞ø.",
      chat_reply_aerator:"‡∞é‡∞∞‡±á‡∞ü‡∞∞‡±ç‡∞≤ ‡∞ó‡±Å‡∞∞‡∞ø‡∞Ç‡∞ö‡∞ø ‡∞µ‡∞ø‡∞µ‡∞∞‡∞æ‡∞≤‡±Å ‡∞ï‡∞æ‡∞µ‡∞æ‡∞≤‡∞æ? ‡∞Æ‡±ã‡∞°‡∞≤‡±ç, ‡∞∏‡∞æ‡∞Æ‡∞∞‡±ç‡∞•‡±ç‡∞Ø‡∞Ç ‡∞≤‡±á‡∞¶‡∞æ ‡∞∏‡±á‡∞µ‡∞≤‡±Å?",
      chat_more_info:"‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞Æ‡±Ä ‡∞∏‡∞Ç‡∞¶‡±á‡∞∂‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞µ‡∞ø‡∞µ‡∞∞‡∞Ç‡∞ó‡∞æ ‡∞ü‡±à‡∞™‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø.",
      purchase_note:"‡∞Æ‡±á‡∞Æ‡±Å ‡∞ß‡∞∞ ‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞°‡±Ü‡∞≤‡∞ø‡∞µ‡∞∞‡±Ä ‡∞®‡∞ø‡∞∞‡±ç‡∞ß‡∞æ‡∞∞‡∞ø‡∞Ç‡∞ö‡∞°‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞Æ‡±Ä‡∞®‡±Å ‡∞∏‡∞Ç‡∞™‡±ç‡∞∞‡∞¶‡∞ø‡∞∏‡±ç‡∞§‡∞æ‡∞Æ‡±Å. (‡∞°‡±Ü‡∞Æ‡±ã ‡∞´‡±ç‡∞≤‡±ã)",
      purchase_request_subject:"‡∞ï‡±ä‡∞®‡±Å‡∞ó‡±ã‡∞≤‡±Å ‡∞Ö‡∞≠‡±ç‡∞Ø‡∞∞‡±ç‡∞•‡∞®"
    };

    /***********************
     * Helpers
     ***********************/
    const $id = id => document.getElementById(id);
    const qsa = s => Array.from(document.querySelectorAll(s));
    function applyI18n() {
      const lang = localStorage.getItem('lang') || 'te';
      document.documentElement.lang = lang;
      qsa('[data-i18n]').forEach(el => {
        const key = el.dataset.i18n;
        if (key && window.dict[lang] && window.dict[lang][key]) el.textContent = window.dict[lang][key];
      });
      // placeholders
      if ($id('pondArea')) $id('pondArea').placeholder = (lang === 'te' ? '‡∞â‡∞¶‡∞æ. 0.5' : 'eg. 0.5');
      if ($id('pondDepthFt')) $id('pondDepthFt').placeholder = (lang === 'te' ? '‡∞â‡∞¶‡∞æ. 4' : 'eg. 4');
      if ($id('chatInput')) $id('chatInput').placeholder = window.dict[localStorage.getItem('lang')||'te'].chat_placeholder || '';
      if ($id('openChat')) $id('openChat').setAttribute('aria-label', window.dict[localStorage.getItem('lang')||'te'].chat_open_aria || '');
      if ($id('closeChat')) $id('closeChat').setAttribute('aria-label', window.dict[localStorage.getItem('lang')||'te'].chat_close_aria || '');
      if ($id('chatTitle')) $id('chatTitle').textContent = window.dict[localStorage.getItem('lang')||'te'].chat_title || '';
    }

    /***********************
     * Model data
     ***********************/
    const MODELS_NEW = [
      { key:'float-2', name_en:'Floating 2Fans', name_te:'‡∞§‡±á‡∞≤‡±á 2 ‡∞´‡±ç‡∞Ø‡∞æ‡∞®‡±ç‡∞∏‡±ç', flow:8000, power:150, price:12000, fans:2, img:'assets/float-2.jpg' },
      { key:'float-4', name_en:'Floating 4Fans', name_te:'‡∞§‡±á‡∞≤‡±á 4 ‡∞´‡±ç‡∞Ø‡∞æ‡∞®‡±ç‡∞∏‡±ç', flow:16000, power:300, price:22000, fans:4, img:'assets/float-4.jpg' },
      { key:'float-6', name_en:'Floating 6Fans', name_te:'‡∞§‡±á‡∞≤‡±á 6 ‡∞´‡±ç‡∞Ø‡∞æ‡∞®‡±ç‡∞∏‡±ç', flow:24000, power:450, price:32000, fans:6, img:'assets/float-6.jpg' },
      { key:'float-8', name_en:'Floating 8Fans', name_te:'‡∞§‡±á‡∞≤‡±á 8 ‡∞´‡±ç‡∞Ø‡∞æ‡∞®‡±ç‡∞∏‡±ç', flow:32000, power:600, price:42000, fans:8, img:'assets/float-8.jpg' }
    ];
    const MODELS_OLD = [
      { key:'used-2', name_en:'Used 2Fans', name_te:'‡∞∞‡±Ü‡∞Ç‡∞°‡∞µ ‡∞ö‡±á‡∞§‡∞ø 2 ‡∞´‡±ç‡∞Ø‡∞æ‡∞®‡±ç‡∞∏‡±ç', flow:7000, power:140, price:7500, fans:2, img:'assets/used-2.jpg' },
      { key:'used-4', name_en:'Used 4Fans', name_te:'‡∞∞‡±Ü‡∞Ç‡∞°‡∞µ ‡∞ö‡±á‡∞§‡∞ø 4 ‡∞´‡±ç‡∞Ø‡∞æ‡∞®‡±ç‡∞∏‡±ç', flow:14000, power:280, price:13500, fans:4, img:'assets/used-4.jpg' }
    ];

    /***********************
     * Tab logic
     ***********************/
    function setActiveTab(sub) {
      qsa('.tab').forEach(t => {
        const s = t.dataset.sub;
        if (s === sub) { t.classList.add('active'); t.setAttribute('aria-pressed','true'); }
        else { t.classList.remove('active'); t.setAttribute('aria-pressed','false'); }
      });
      qsa('#modelsGrid [data-sub]').forEach(card => {
        card.style.display = (card.dataset.sub === sub) ? '' : 'none';
      });
    }

    /***********************
     * Calculator (acres + depth in feet)
     ***********************/
    const ACRE_TO_M2 = 4046.85642;
    const FT_TO_M = 0.3048;

    function estimateFromAcresFeet(acres, depthFt) {
      const depthM = depthFt * FT_TO_M;
      const area_m2 = acres * ACRE_TO_M2;
      const volume_m3 = area_m2 * depthM;
      const liters = volume_m3 * 1000;
      const needed_lph = Math.max(500, Math.round(liters * 0.10)); // 10% turnover
      // recommend cheapest combination using new models (simple)
      const recs = MODELS_NEW.map(m => {
        const units = Math.ceil(needed_lph / m.flow);
        return { model: m, units, totalFlow: units * m.flow, totalPower: units * m.power, totalPrice: units * m.price };
      });
      recs.sort((a,b)=>a.totalPrice - b.totalPrice);
      const best = recs[0];
      return { area_m2:+area_m2.toFixed(2), depth_m:+depthM.toFixed(2), volume_m3:+volume_m3.toFixed(2), liters:Math.round(liters), needed_lph, bestRecommendation:best, allRecommendations:recs };
    }

    function showCalcResult(obj) {
      const el = $id('calcResult');
      if(!el) return;
      const lang = localStorage.getItem('lang') || 'te';
      const en = `Estimated pond: ${obj.volume_m3} m¬≥ (${obj.liters.toLocaleString()} L). Recommend ~${obj.needed_lph} L/h. Best: ${obj.bestRecommendation.units} √ó ${obj.bestRecommendation.model.name_en} (total flow ${obj.bestRecommendation.totalFlow} L/h).`;
      const te = `‡∞Ö‡∞Ç‡∞ö‡∞®‡∞æ ‡∞ö‡±Ü‡∞∞‡±Å‡∞µ‡±Å: ${obj.volume_m3} m¬≥ (${obj.liters.toLocaleString()} L). ‡∞∏‡±Å‡∞Æ‡∞æ‡∞∞‡±Å ${obj.needed_lph} L/h ‡∞Ö‡∞µ‡∞∏‡∞∞‡∞Ç. ‡∞â‡∞§‡±ç‡∞§‡∞Æ ‡∞∏‡±Ç‡∞ö‡∞®: ${obj.bestRecommendation.units} √ó ${obj.bestRecommendation.model.name_te} (‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç ‡∞´‡±ç‡∞≤‡±ã ${obj.bestRecommendation.totalFlow} L/h).`;
      el.innerHTML = `<div class="font-medium">${en}</div><div class="text-sm text-slate-600 dark:text-slate-300 mt-1">${te}</div>`;
      el.innerHTML += `<div class="mt-3 flex gap-2"><button class="navbtn" id="applyRecBtn">Select & Request Quote</button><button class="navbtn bg-white/60" id="viewOptionsBtn">View Models</button></div>`;
      el.classList.remove('hidden');

      setTimeout(()=>{
        const apply = $id('applyRecBtn');
        if (apply) apply.onclick = () => {
          const chatBtn = $id('openChat'); if (chatBtn) chatBtn.click();
          setTimeout(()=>{
            const input = $id('chatInput');
            if (input) {
              const enMsg = `Requesting quote: ${obj.bestRecommendation.units} √ó ${obj.bestRecommendation.model.name_en} (‚Çπ${obj.bestRecommendation.totalPrice}). Please assist.`;
              const teMsg = `‡∞ï‡±ã‡∞ü‡±ç ‡∞ï‡∞æ‡∞µ‡∞æ‡∞≤‡∞ø: ${obj.bestRecommendation.units} √ó ${obj.bestRecommendation.model.name_te} (‚Çπ${obj.bestRecommendation.totalPrice}). ‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞∏‡∞π‡∞æ‡∞Ø‡∞™‡∞°‡∞Ç‡∞°‡∞ø.`;
              input.value = `${enMsg}\n${teMsg}`; input.focus();
            }
          },300);
        };
        const view = $id('viewOptionsBtn');
        if (view) view.onclick = ()=> document.querySelector('#modelsGrid').scrollIntoView({behavior:'smooth', block:'center'});
      },50);
    }

    /***********************
     * Chat
     ***********************/
    function escapeHtml(str){ return (str||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
    function appendUserMessage(text){ const div=document.createElement('div'); div.className='msg user'; div.innerText=text; $id('chatMessages').appendChild(div); $id('chatMessages').scrollTop=$id('chatMessages').scrollHeight; }
    function appendBotMessage(en, te){ const div=document.createElement('div'); div.className='msg bot'; div.innerHTML = `<div class="reply-en">${escapeHtml(en)}</div><div class="reply-te">${escapeHtml(te)}</div>`; $id('chatMessages').appendChild(div); $id('chatMessages').scrollTop=$id('chatMessages').scrollHeight; }
    function injectInitialGreeting(){ const en=window.dict.en.chat_greeting||'Hi! How can I help you today?'; const te=window.dict.te.chat_greeting||'‡∞π‡∞æ‡∞Ø‡±ç! ‡∞®‡±á‡∞®‡±Å ‡∞à‡∞∞‡±ã‡∞ú‡±Å ‡∞é‡∞≤‡∞æ ‡∞∏‡∞π‡∞æ‡∞Ø‡∞Ç ‡∞ö‡±á‡∞Ø‡∞ó‡∞≤‡∞®‡±Å?'; appendBotMessage(en,te); }
    function botReply(userText){ const t=(userText||'').toLowerCase(); let en=window.dict.en.chat_reply_default, te=window.dict.te.chat_reply_default; if (t.includes('aerator')||t.includes('‡∞é‡∞∞‡±á‡∞ü‡∞∞‡±ç')) { en=window.dict.en.chat_reply_aerator; te=window.dict.te.chat_reply_aerator; } else if ((userText||'').trim().length<3) { en=window.dict.en.chat_more_info; te=window.dict.te.chat_more_info; } setTimeout(()=>appendBotMessage(en,te), 500); }

    /***********************
     * Purchase modal
     ***********************/
    function openPurchaseModal(model, price) {
      $id('purchaseModel').value = model;
      $id('purchasePrice').value = price;
      $id('modalModel').textContent = `${model}${price ? ' ‚Ä¢ ‚Çπ' + price : ''}`;
      $id('buyerName').value = ''; $id('buyerPhone').value = ''; $id('buyerPlace').value = '';
      $id('modalOverlay').classList.add('open'); $id('modalOverlay').setAttribute('aria-hidden','false');
    }
    function closePurchaseModal() {
      $id('modalOverlay').classList.remove('open'); $id('modalOverlay').setAttribute('aria-hidden','true');
    }
    function submitPurchaseForm(e) {
      e.preventDefault();
      const model = $id('purchaseModel').value;
      const price = $id('purchasePrice').value;
      const name = $id('buyerName').value.trim();
      const phone = $id('buyerPhone').value.trim();
      const place = $id('buyerPlace').value.trim();
      if (!name || !phone) { alert(localStorage.getItem('lang')==='te' ? '‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞™‡±á‡∞∞‡±Å ‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞´‡±ã‡∞®‡±ç ‡∞®‡∞Ç‡∞¨‡∞∞‡±ç ‡∞á‡∞µ‡±ç‡∞µ‡∞Ç‡∞°‡∞ø.' : 'Please enter name and phone number.'); return; }
      const chatBtn = $id('openChat'); if (chatBtn) chatBtn.click();
      setTimeout(()=> {
        const input = $id('chatInput');
        if (input) {
          const en = `Purchase request: ${model}${price ? ' (‚Çπ'+price+')' : ''}. Buyer: ${name}, Phone: ${phone}, Place: ${place || '-'}.`;
          const te = `‡∞ï‡±ä‡∞®‡±Å‡∞ó‡±ã‡∞≤‡±Å ‡∞Ö‡∞≠‡±ç‡∞Ø‡∞∞‡±ç‡∞•‡∞®: ${model}${price ? ' (‚Çπ'+price+')' : ''}. ‡∞ï‡±ä‡∞®‡±Å‡∞ó‡±ã‡∞≤‡±Å ‡∞¶‡∞æ‡∞∞‡±Å‡∞°‡±Å: ${name}, ‡∞´‡±ã‡∞®‡±ç: ${phone}, ‡∞∏‡±ç‡∞•‡∞≤‡∞Ç: ${place || '-'}.`;
          input.value = `${en}\n${te}`; input.focus();
        } else {
          const subject = encodeURIComponent(window.dict[localStorage.getItem('lang')||'te'].purchase_request_subject || 'Purchase request');
          const body = encodeURIComponent(`${model} (${price ? '‚Çπ'+price : ''})\nName: ${name}\nPhone: ${phone}\nPlace: ${place}\n\nPlease contact me.`);
          window.location.href = `mailto:info@example.com?subject=${subject}&body=${body}`;
        }
      },300);
      closePurchaseModal();
    }

    /***********************
     * Init
     ***********************/
    document.addEventListener('DOMContentLoaded', () => {
      if (!localStorage.getItem('lang')) localStorage.setItem('lang','te');
      $id('langSel').value = localStorage.getItem('lang') || 'te';
      applyI18n();

      // theme toggle
      const saved = localStorage.getItem('theme');
      if (saved === 'dark' || (!saved && matchMedia('(prefers-color-scheme: dark)').matches)) document.documentElement.classList.add('dark');
      $id('themeToggle').addEventListener('click', ()=> { document.documentElement.classList.toggle('dark'); localStorage.setItem('theme', document.documentElement.classList.contains('dark')?'dark':'light'); });

      // tabs
      $id('tabNew').addEventListener('click', () => setActiveTab('new'));
      $id('tabOld').addEventListener('click', () => setActiveTab('old'));
      setActiveTab('new');

      // calc wiring
      $id('calcBtn').addEventListener('click', ()=> {
        const acres = parseFloat($id('pondArea').value) || 0;
        const depthFt = parseFloat($id('pondDepthFt').value) || 0;
        if (acres <= 0 || depthFt <= 0) { alert(localStorage.getItem('lang')==='te' ? '‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞∏‡∞∞‡±à‡∞® ‡∞µ‡∞ø‡∞≤‡±Å‡∞µ‡∞≤‡±Å ‡∞á‡∞µ‡±ç‡∞µ‡∞Ç‡∞°‡∞ø.' : 'Please enter valid values.'); return; }
        const res = estimateFromAcresFeet(acres, depthFt);
        showCalcResult(res);
      });
      $id('calcReset').addEventListener('click', ()=> { $id('pondArea').value=''; $id('pondDepthFt').value=''; $id('calcResult').classList.add('hidden'); $id('calcResult').innerHTML=''; });

      // chat wiring
      const openChat = $id('openChat'), chatPanel = $id('chatPanel'), closeChat = $id('closeChat'), sendBtn = $id('sendBtn'), chatInput = $id('chatInput');
      injectInitialGreeting();
      openChat.addEventListener('click', ()=> { chatPanel.classList.add('open'); applyI18n(); chatInput.focus(); });
      closeChat.addEventListener('click', ()=> { chatPanel.classList.remove('open'); openChat.focus(); });
      sendBtn.addEventListener('click', ()=> { const txt = chatInput.value.trim(); if (!txt) return; appendUserMessage(txt); chatInput.value=''; botReply(txt); });
      chatInput.addEventListener('keydown', (e)=> { if (e.key==='Enter') { e.preventDefault(); sendBtn.click(); }});
      document.addEventListener('keydown', (e)=> { if (e.key==='Escape' && chatPanel.classList.contains('open')) { chatPanel.classList.remove('open'); openChat.focus(); }});

      // model buttons: Details & Buy
      document.body.addEventListener('click', (ev)=> {
        const t = ev.target;
        if (!t) return;
        if (t.matches && t.matches('.btn-details')) {
          const specs = JSON.parse(t.getAttribute('data-specs')||'{}');
          const flow = specs.flow||'-', power = specs.power||'-', fans = specs.fans||'-';
          const en = `Specs ‚Äî Flow: ${flow}, Power: ${power}, Fans: ${fans}`;
          const te = `‡∞µ‡∞ø‡∞µ‡∞∞‡∞æ‡∞≤‡±Å ‚Äî ‡∞´‡±ç‡∞≤‡±ã: ${flow}, ‡∞∂‡∞ï‡±ç‡∞§‡∞ø: ${power}, ‡∞´‡±ç‡∞Ø‡∞æ‡∞®‡±ç‡∞∏‡±ç: ${fans}`;
          alert(`${en}\n\n${te}`);
          return;
        }
        if (t.matches && t.matches('.btn-buy')) {
          const model = t.getAttribute('data-model')||'Model';
          const price = t.getAttribute('data-price')||'';
          $id('purchaseModel') ? openPurchaseModal(model, price) : (function(){ $id('purchaseModel') && openPurchaseModal(model, price); })();
          openPurchaseModal(model, price);
          return;
        }
      });

      // purchase modal wiring
      $id('modalClose').addEventListener('click', closePurchaseModal);
      $id('purchaseCancel').addEventListener('click', closePurchaseModal);
      $id('purchaseForm').addEventListener('submit', submitPurchaseForm);

      // lang select
      $id('langSel').addEventListener('change', (e)=> { localStorage.setItem('lang', e.target.value); applyI18n(); });
    });

    // helper reused function referenced earlier
    function estimateFromAcresFeet(acres, depthFt) {
      const ACRE_TO_M2 = 4046.85642;
      const FT_TO_M = 0.3048;
      const depthM = depthFt * FT_TO_M;
      const area_m2 = acres * ACRE_TO_M2;
      const volume_m3 = area_m2 * depthM;
      const liters = volume_m3 * 1000;
      const needed_lph = Math.max(500, Math.round(liters * 0.10));
      const recs = MODELS_NEW.map(m => {
        const units = Math.ceil(needed_lph / m.flow);
        return { model: m, units, totalFlow: units * m.flow, totalPower: units * m.power, totalPrice: units * m.price };
      });
      recs.sort((a,b)=>a.totalPrice - b.totalPrice);
      return { area_m2:+area_m2.toFixed(2), depth_m:+depthM.toFixed(2), volume_m3:+volume_m3.toFixed(2), liters:Math.round(liters), needed_lph, bestRecommendation:recs[0], allRecommendations:recs };
    }
  </script>
</body>
</html>
