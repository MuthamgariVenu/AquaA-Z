<!DOCTYPE html>
<html lang="te">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Aquaculture A‚ÄìZ ‚Ä¢ Aerator</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { darkMode: 'class', theme: { extend: { boxShadow: { soft: '0 12px 28px rgba(2,6,23,.08)' } } } };
  </script>

  <style>
    html { scroll-behavior: smooth; }
    body { background: linear-gradient(135deg,#dbeafe 0%,#e0f2fe 50%,#f0fdf4 100%); }
    .dark body { background: linear-gradient(135deg,#0f172a 0%,#082f49 50%,#14532d 100%); }
    .navbtn { border:1px solid rgb(226,232,240); padding:.55rem .9rem; border-radius:.75rem; background:#fff; text-align:center; font-weight:700; font-size:1rem; white-space:nowrap; }
    .dark .navbtn { background:#0b1220; border-color:#1f2937; }
    .shadow-soft { box-shadow: var(--tw-ring-offset-shadow, 0 0 transparent), var(--tw-ring-shadow, 0 0 transparent), 0 12px 28px rgba(2,6,23,.06); }

    /* Chat styles */
    .chat-btn { position: fixed; right: 16px; bottom: 78px; width: 56px; height: 56px; border-radius: 50%; background: #0b6b6b; color: #fff; display: flex; align-items: center; justify-content: center; box-shadow: 0 6px 18px rgba(11,107,107,0.18); border: none; z-index: 2000; font-size: 20px; }
    .chat-panel { position: fixed; right: 14px; bottom: 148px; width: 92%; max-width: 360px; height: 56vh; max-height: 520px; background: #fff; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.12); display: none; flex-direction: column; overflow: hidden; z-index: 2000; }
    .chat-panel.open { display: flex; }
    .chat-header { padding: 12px; border-bottom: 1px solid #eee; display:flex;align-items:center;justify-content:space-between; }
    .chat-messages { flex:1; padding:12px; overflow:auto; display:flex;flex-direction:column; gap:8px; background:#fbfbfb; }
    .msg { max-width:78%; padding:8px 10px; border-radius:10px; font-size:14px; }
    .msg.user { align-self:flex-end; background:#0b6b6b; color:#fff; }
    .msg.bot { align-self:flex-start; background:#fff; color:#111; border:1px solid #eee; }
    .reply-en { font-weight:700; margin-bottom:4px; }
    .reply-te { color:#475569; font-size:13px; opacity:0.95; }

    /* Modal overlay */
    .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.35); display: none; align-items: center; justify-content: center; z-index: 3000; }
    .modal-overlay.open { display: flex; }

    /* Tabs */
    .tab { padding: .5rem 1rem; border-radius: 999px; cursor: pointer; border: 1px solid transparent; }
    .tab.active { background: #0b6b6b; color: #fff; border-color: #0b6b6b; }

    @media(max-width:420px){ .chat-panel{ right:8px; left:8px; max-width:none } }
  </style>
</head>
<body class="text-slate-900 dark:text-slate-100">

  <!-- Header -->
  <header class="sticky top-0 z-40 backdrop-blur bg-white/80 dark:bg-slate-950/70 border-b border-slate-200 dark:border-slate-800">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center">
      <div class="flex items-center gap-3">
        <div class="h-9 w-9">
          <img src="assets/logo.png" alt="Logo" class="h-9 w-9 object-contain block dark:hidden">
          <img src="assets/logo-dark.png" alt="Logo" class="h-9 w-9 object-contain hidden dark:block">
        </div>
        <h1 class="text-xl font-bold">Aquaculture A‚ÄìZ</h1>
      </div>

      <nav class="ml-auto hidden sm:flex gap-3">
        <a href="index.html" class="navbtn">üè† <span data-i18n="m_home">Home</span></a>
        <a href="aerator.html" class="navbtn">‚öôÔ∏è <span data-i18n="m_aerator">Aerator</span></a>
        <a href="history.html" class="navbtn">üìú <span data-i18n="m_history">History</span></a>
      </nav>

      <div class="ml-4 flex items-center gap-2">
        <label for="langSel" class="text-sm select-none">Ln</label>
        <select id="langSel" class="text-sm border rounded-md px-2 py-1 dark:bg-slate-900 dark:border-slate-700">
          <option value="te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</option>
          <option value="en">English</option>
        </select>
        <button id="themeToggle" class="rounded-full px-3 py-1.5 text-sm border">üåô/‚òÄÔ∏è</button>
      </div>
    </div>
  </header>

  <main class="max-w-7xl mx-auto p-4 space-y-4 pb-40">

    <!-- Hero -->
    <section class="rounded-2xl p-4 bg-white dark:bg-slate-900 shadow-soft border">
      <div class="flex items-start justify-between gap-4">
        <div>
          <h2 class="text-lg font-semibold flex items-center gap-2">‚öôÔ∏è <span data-i18n="m_aerator">Aerator</span></h2>
          <p class="mt-2 text-slate-600 dark:text-slate-300" data-i18n="aerator_desc">
            Aerators help maintain oxygen levels in ponds ‚Äî models, power and maintenance guidance shown below.
          </p>
        </div>

        <!-- Submodule tabs -->
        <div class="flex items-center gap-2">
          <div id="tabNew" class="tab active" role="button" aria-pressed="true" data-sub="new" data-i18n="tab_new">New</div>
          <div id="tabOld" class="tab" role="button" aria-pressed="false" data-sub="old" data-i18n="tab_old">Old</div>
        </div>
      </div>
    </section>

    <!-- Main content: left calculator, right models (filter by submodule tab) -->
    <section class="grid grid-cols-1 lg:grid-cols-2 gap-4">
      <!-- Calculator -->
      <div class="rounded-xl p-4 bg-slate-50 dark:bg-slate-800/40 border">
        <h3 class="font-semibold mb-2" data-i18n="calc_title">Aerator Calculator</h3>

        <label class="text-xs font-medium" for="pondArea" data-i18n="calc_area_label">Pond area (m¬≤)</label>
        <input id="pondArea" type="number" min="1" step="0.1" placeholder="eg. 1000" class="mt-1 w-full rounded-md border px-3 py-2 dark:bg-slate-900" />

        <label class="text-xs font-medium mt-3 block" for="pondDepth" data-i18n="calc_depth_label">Average depth (m)</label>
        <input id="pondDepth" type="number" min="0.1" step="0.1" placeholder="eg. 1.2" class="mt-1 w-full rounded-md border px-3 py-2 dark:bg-slate-900" />

        <div class="mt-3 flex items-center gap-2">
          <button id="calcBtn" class="navbtn flex-1" data-i18n="calc_btn">Calculate</button>
          <button id="calcReset" class="navbtn bg-white/60" data-i18n="calc_reset">Reset</button>
        </div>

        <div id="calcResult" class="mt-3 text-sm text-slate-700 dark:text-slate-200 hidden" aria-live="polite"></div>
        <p class="mt-3 text-xs text-slate-500" data-i18n="calc_note">Note: This is an estimate; consult product specs for exact selection.</p>
      </div>

      <!-- Models area ( New / Old filtered ) -->
      <div id="modelsArea" class="space-y-4">
        <!-- Model cards grid (will filter by tab) -->
        <div id="modelsGrid" class="grid grid-cols-1 sm:grid-cols-2 gap-3">
          <!-- Cards: each has data-sub="new" or data-sub="old" -->
          <article class="rounded-xl p-3 bg-white dark:bg-slate-900 border" data-sub="new">
            <div class="flex items-start gap-3">
              <img src="assets/aerator-1.jpg" alt="AquaAir 100" class="w-20 h-20 object-cover rounded-md flex-none">
              <div class="flex-1">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="font-semibold">AquaAir 100</div>
                    <div class="text-xs text-slate-500 mt-1" data-i18n="model_flow">Flow: 2000 L/h ¬∑ Power: 75 W</div>
                  </div>
                  <div class="text-sm font-bold">‚Çπ 8,500</div>
                </div>
                <p class="mt-2 text-sm text-slate-600 dark:text-slate-300 model-desc" data-i18n="model_desc_small">Best for small ponds up to 1000 m¬≥.</p>

                <div class="mt-3 flex gap-2">
                  <button class="navbtn btn-request" data-model="AquaAir 100" data-price="8500">Request Quote</button>
                  <button class="navbtn btn-specs" data-specs='{"flow":"2000 L/h","power":"75W"}'>Specs</button>
                  <button class="navbtn bg-emerald-50 text-emerald-800 btn-buy" data-model="AquaAir 100" data-price="8500">Buy</button>
                </div>
              </div>
            </div>
          </article>

          <article class="rounded-xl p-3 bg-white dark:bg-slate-900 border" data-sub="new">
            <div class="flex items-start gap-3">
              <img src="assets/aerator-2.jpg" alt="ProOxy 300" class="w-20 h-20 object-cover rounded-md flex-none">
              <div class="flex-1">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="font-semibold">ProOxy 300</div>
                    <div class="text-xs text-slate-500 mt-1" data-i18n="model_flow">Flow: 6000 L/h ¬∑ Power: 180 W</div>
                  </div>
                  <div class="text-sm font-bold">‚Çπ 18,500</div>
                </div>
                <p class="mt-2 text-sm text-slate-600 dark:text-slate-300 model-desc" data-i18n="model_desc_medium">For medium ponds or multiple small ponds.</p>

                <div class="mt-3 flex gap-2">
                  <button class="navbtn btn-request" data-model="ProOxy 300" data-price="18500">Request Quote</button>
                  <button class="navbtn btn-specs" data-specs='{"flow":"6000 L/h","power":"180W"}'>Specs</button>
                  <button class="navbtn bg-emerald-50 text-emerald-800 btn-buy" data-model="ProOxy 300" data-price="18500">Buy</button>
                </div>
              </div>
            </div>
          </article>

          <article class="rounded-xl p-3 bg-white dark:bg-slate-900 border" data-sub="old">
            <div class="flex items-start gap-3">
              <img src="assets/aerator-3.jpg" alt="MaxBub 750" class="w-20 h-20 object-cover rounded-md flex-none">
              <div class="flex-1">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="font-semibold">MaxBub 750</div>
                    <div class="text-xs text-slate-500 mt-1" data-i18n="model_flow">Flow: 15000 L/h ¬∑ Power: 420 W</div>
                  </div>
                  <div class="text-sm font-bold">‚Çπ 42,000</div>
                </div>
                <p class="mt-2 text-sm text-slate-600 dark:text-slate-300 model-desc" data-i18n="model_desc_large">Large ponds and commercial farms.</p>

                <div class="mt-3 flex gap-2">
                  <button class="navbtn btn-request" data-model="MaxBub 750" data-price="42000">Request Quote</button>
                  <button class="navbtn btn-specs" data-specs='{"flow":"15000 L/h","power":"420W"}'>Specs</button>
                  <button class="navbtn bg-emerald-50 text-emerald-800 btn-buy" data-model="MaxBub 750" data-price="42000">Buy</button>
                </div>
              </div>
            </div>
          </article>

          <article class="rounded-xl p-3 bg-white dark:bg-slate-900 border" data-sub="old">
            <div class="flex items-start gap-3">
              <img src="assets/aerator-4.jpg" alt="OldPro 500" class="w-20 h-20 object-cover rounded-md flex-none">
              <div class="flex-1">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="font-semibold">OldPro 500</div>
                    <div class="text-xs text-slate-500 mt-1" data-i18n="model_flow">Flow: 9000 L/h ¬∑ Power: 260 W</div>
                  </div>
                  <div class="text-sm font-bold">‚Çπ 26,500</div>
                </div>
                <p class="mt-2 text-sm text-slate-600 dark:text-slate-300 model-desc" data-i18n="model_desc_reliable">Reliable and low-maintenance for steady operations.</p>

                <div class="mt-3 flex gap-2">
                  <button class="navbtn btn-request" data-model="OldPro 500" data-price="26500">Request Quote</button>
                  <button class="navbtn btn-specs" data-specs='{"flow":"9000 L/h","power":"260W"}'>Specs</button>
                  <button class="navbtn bg-emerald-50 text-emerald-800 btn-buy" data-model="OldPro 500" data-price="26500">Buy</button>
                </div>
              </div>
            </div>
          </article>

        </div>

        <!-- FAQs -->
        <div class="rounded-xl p-3 bg-slate-50 dark:bg-slate-800/40 border">
          <div class="font-semibold" data-i18n="faq_title">FAQs</div>
          <ul class="mt-2 text-sm text-slate-600 dark:text-slate-300 space-y-1">
            <li><strong data-i18n="faq_q1">How often to maintain?</strong> <span data-i18n="faq_a1">Monthly check & cleaning recommended.</span></li>
            <li><strong data-i18n="faq_q2">Power consumption?</strong> <span data-i18n="faq_a2">See model specs ‚Äî typical range 75W‚Äì420W.</span></li>
          </ul>
        </div>
      </div>
    </section>

  </main>

  <!-- Bottom nav (mobile) -->
  <nav class="fixed bottom-0 inset-x-0 bg-white dark:bg-slate-900 border-t border-slate-200 dark:border-slate-700 flex justify-around py-2 z-40 sm:hidden" style="padding-bottom: env(safe-area-inset-bottom);">
    <a href="index.html" class="flex flex-col items-center text-base font-semibold"><span>üè†</span><span data-i18n="m_home">Home</span></a>
    <a href="aerator.html" class="flex flex-col items-center text-base font-semibold"><span>‚öôÔ∏è</span><span data-i18n="m_aerator">Aerator</span></a>
    <a href="history.html" class="flex flex-col items-center text-base font-semibold"><span>üïò</span><span data-i18n="m_history">History</span></a>
  </nav>

  <!-- Chat (bilingual) -->
  <button class="chat-btn" id="openChat" aria-label="Open chat">üí¨</button>

  <div class="chat-panel" id="chatPanel" role="dialog" aria-label="Chat with Aqua A-Z">
    <div class="chat-header">
      <div class="chat-title" id="chatTitle" data-i18n="chat_title">Help & Chat</div>
      <button id="closeChat" aria-label="Close chat" style="background:none;border:none;font-size:18px;padding:6px;cursor:pointer">‚úï</button>
    </div>

    <div class="chat-messages" id="chatMessages" aria-live="polite"></div>

    <div class="chat-input" role="form" aria-label="Chat input">
      <input id="chatInput" type="text" placeholder="Type a message..." aria-label="Type a message" />
      <button id="sendBtn" aria-label="Send message">Send</button>
    </div>
  </div>

  <!-- Purchase Modal -->
  <div class="modal-overlay" id="modalOverlay" aria-hidden="true">
    <div class="bg-white dark:bg-slate-900 rounded-xl w-full max-w-md p-4 shadow-soft">
      <div class="flex items-center justify-between">
        <h3 class="font-semibold" id="modalTitle">Buy ‚Äî <span id="modalModel">Model</span></h3>
        <button id="modalClose" aria-label="Close" style="background:none;border:none;font-size:18px">‚úï</button>
      </div>

      <form id="purchaseForm" class="mt-3 space-y-2">
        <input type="hidden" id="purchaseModel" name="model" />
        <input type="hidden" id="purchasePrice" name="price" />

        <label class="text-xs">Name</label>
        <input id="buyerName" class="w-full rounded-md border px-3 py-2" required />

        <label class="text-xs">Phone</label>
        <input id="buyerPhone" class="w-full rounded-md border px-3 py-2" required />

        <label class="text-xs">Village / City</label>
        <input id="buyerPlace" class="w-full rounded-md border px-3 py-2" />

        <div class="flex items-center gap-2 mt-2">
          <button id="purchaseSubmit" class="navbtn flex-1">Request Purchase</button>
          <button id="purchaseCancel" type="button" class="navbtn bg-white/60">Cancel</button>
        </div>
        <p class="text-xs text-slate-500 mt-2">We will contact you to confirm price and delivery. (Demo flow)</p>
      </form>
    </div>
  </div>

  <script>
    /***********************
     * i18n dictionary (defaults)
     ***********************/
    window.dict = window.dict || {};
    window.dict.en = window.dict.en || {
      m_aerator:"Aerator", m_home:"Home", m_history:"History",
      calc_title:"Aerator Calculator", calc_area_label:"Pond area (m¬≤)", calc_depth_label:"Average depth (m)",
      calc_btn:"Calculate", calc_reset:"Reset", calc_note:"Note: This is an estimate; consult product specs for exact selection.",
      tab_new:"New", tab_old:"Old",
      model_flow:"Flow: {flow} ¬∑ Power: {power}",
      model_desc_small:"Best for small ponds up to 1000 m¬≥.",
      model_desc_medium:"For medium ponds or multiple small ponds.",
      model_desc_large:"Large ponds and commercial farms.",
      model_desc_reliable:"Reliable and low-maintenance for steady operations.",
      faq_title:"FAQs", faq_q1:"How often to maintain?", faq_a1:"Monthly check & cleaning recommended.", faq_q2:"Power consumption?", faq_a2:"See model specs ‚Äî typical range 75W‚Äì420W.",
      chat_title:"Help & Chat", chat_greeting:"Hi! How can I help you today?", chat_placeholder:"Type a message...", chat_open_aria:"Open chat", chat_close_aria:"Close chat",
      chat_reply_default:"Sorry, I cannot perform that now; but I can help. Please give more details.",
      chat_reply_aerator:"What details about aerators do you need? Model, capacity, or services?",
      chat_reply_history:"History: latest updates are managed by site admin and shown here when available.",
      chat_more_info:"Please type a more detailed message.",
      purchase_request_subject:"Purchase request"
    };
    window.dict.te = window.dict.te || {
      m_aerator:"‡∞é‡∞∞‡±á‡∞ü‡∞∞‡±ç", m_home:"‡∞π‡±ã‡∞Æ‡±ç", m_history:"‡∞ö‡∞∞‡∞ø‡∞§‡±ç‡∞∞",
      calc_title:"‡∞é‡∞∞‡±á‡∞ü‡∞∞‡±ç ‡∞ï‡±á‡∞≤‡±ç‡∞ï‡±ç‡∞Ø‡±Å‡∞≤‡±á‡∞ü‡∞∞‡±ç", calc_area_label:"‡∞ö‡±Ü‡∞∞‡±Å‡∞µ‡±Å ‡∞â‡∞™‡∞∞‡∞ø‡∞§‡∞≤‡∞Ç (m¬≤)", calc_depth_label:"‡∞∏‡∞ó‡∞ü‡±Å ‡∞≤‡±ã‡∞§‡±Å (m)",
      calc_btn:"‡∞≤‡±Ü‡∞ï‡±ç‡∞ï‡∞ø‡∞Ç‡∞ö‡±Å", calc_reset:"‡∞∞‡±Ä‡∞∏‡±Ü‡∞ü‡±ç", calc_note:"‡∞ó‡∞Æ‡∞®‡∞ø‡∞ï: ‡∞á‡∞¶‡∞ø ‡∞í‡∞ï ‡∞Ö‡∞Ç‡∞ö‡∞®‡∞æ ‡∞Æ‡∞æ‡∞§‡±ç‡∞∞‡∞Æ‡±á; ‡∞ñ‡∞ö‡±ç‡∞ö‡∞ø‡∞§ ‡∞é‡∞Ç‡∞™‡∞ø‡∞ï ‡∞ï‡±ã‡∞∏‡∞Ç ‡∞â‡∞§‡±ç‡∞™‡∞§‡±ç‡∞§‡∞ø ‡∞µ‡∞ø‡∞µ‡∞∞‡∞æ‡∞≤‡±Å ‡∞™‡∞∞‡∞ø‡∞∂‡±Ä‡∞≤‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø.",
      tab_new:"‡∞ï‡±ä‡∞§‡±ç‡∞§", tab_old:"‡∞™‡∞æ‡∞§",
      model_flow:"‡∞´‡±ç‡∞≤‡±ã: {flow} ¬∑ ‡∞∂‡∞ï‡±ç‡∞§‡∞ø: {power}",
      model_desc_small:"‡∞ö‡∞ø‡∞®‡±ç‡∞® ‡∞ö‡±Ü‡∞∞‡±Å‡∞µ‡±Å‡∞≤‡∞ï‡±Å (1000 m¬≥ ‡∞µ‡∞∞‡∞ï‡±Å) ‡∞â‡∞§‡±ç‡∞§‡∞Æ‡∞Ç‡∞ó‡∞æ.",
      model_desc_medium:"‡∞Æ‡∞ß‡±ç‡∞Ø‡∞Æ ‡∞ö‡±Ü‡∞∞‡±Å‡∞µ‡±Å‡∞≤ ‡∞ï‡±ã‡∞∏‡∞Ç ‡∞≤‡±á‡∞¶‡∞æ ‡∞¨‡∞π‡±Å‡∞≥ ‡∞ö‡∞ø‡∞®‡±ç‡∞® ‡∞ö‡±Ü‡∞∞‡±Å‡∞µ‡±Å‡∞≤ ‡∞ï‡±ã‡∞∏‡∞Ç.",
      model_desc_large:"‡∞™‡±Ü‡∞¶‡±ç‡∞¶ ‡∞ö‡±Ü‡∞∞‡±Å‡∞µ‡±Å‡∞≤‡±Å ‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞µ‡∞æ‡∞£‡∞ø‡∞ú‡±ç‡∞Ø ‡∞´‡∞æ‡∞∞‡∞Æ‡±ç‚Äå‡∞≤ ‡∞ï‡±ã‡∞∏‡∞Ç.",
      model_desc_reliable:"‡∞®‡∞ø‡∞∞‡∞Ç‡∞§‡∞∞ ‡∞Ü‡∞™‡∞∞‡±á‡∞∑‡∞®‡±ç‡∞≤ ‡∞ï‡±ã‡∞∏‡∞Ç ‡∞µ‡∞ø‡∞∂‡±ç‡∞µ‡∞∏‡∞®‡±Ä‡∞Ø ‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞§‡∞ï‡±ç‡∞ï‡±Å‡∞µ ‡∞®‡∞ø‡∞∞‡±ç‡∞µ‡∞π‡∞£.",
      faq_title:"‡∞™‡±ç‡∞∞‡∞∂‡±ç‡∞®‡∞≤ ‡∞ú‡∞µ‡∞æ‡∞¨‡±Å‡∞≤‡±Å", faq_q1:"‡∞é‡∞®‡±ç‡∞®‡∞ø ‡∞∏‡∞æ‡∞∞‡±ç‡∞≤‡±Å ‡∞®‡∞ø‡∞∞‡±ç‡∞µ‡∞π‡∞ø‡∞Ç‡∞ö‡∞æ‡∞≤‡∞ø?", faq_a1:"‡∞Æ‡∞æ‡∞∏‡∞Ç‡∞≤‡±ã‡∞®‡∞ø ‡∞§‡∞®‡∞ø‡∞ñ‡±Ä ‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞∂‡±Å‡∞≠‡±ç‡∞∞‡∞Ç ‡∞∏‡∞ø‡∞´‡∞æ‡∞∞‡±ç‡∞∏‡±Å ‡∞ö‡±á‡∞Ø‡∞¨‡∞°‡±Å‡∞§‡±Å‡∞Ç‡∞¶‡∞ø.", faq_q2:"‡∞∂‡∞ï‡±ç‡∞§‡∞ø ‡∞µ‡∞ø‡∞®‡∞ø‡∞Ø‡±ã‡∞ó‡∞Ç?", faq_a2:"‡∞Æ‡±ã‡∞°‡∞≤‡±ç ‡∞∏‡±ç‡∞™‡±Ü‡∞ï‡±ç‡∞∏‡±ç ‡∞ö‡±Ç‡∞°‡∞Ç‡∞°‡∞ø ‚Äî ‡∞∏‡∞ó‡∞ü‡±Å ‡∞∂‡±ç‡∞∞‡±á‡∞£‡∞ø 75W‚Äì420W.",
      chat_title:"‡∞∏‡∞π‡∞æ‡∞Ø‡∞Ç & ‡∞ö‡∞æ‡∞ü‡±ç", chat_greeting:"‡∞π‡∞æ‡∞Ø‡±ç! ‡∞®‡±á‡∞®‡±Å ‡∞à‡∞∞‡±ã‡∞ú‡±Å ‡∞é‡∞≤‡∞æ ‡∞∏‡∞π‡∞æ‡∞Ø‡∞Ç ‡∞ö‡±á‡∞Ø‡∞ó‡∞≤‡∞®‡±Å?", chat_placeholder:"‡∞Æ‡±Ä ‡∞∏‡∞Ç‡∞¶‡±á‡∞∂‡∞Ç ‡∞∞‡∞æ‡∞Ø‡∞Ç‡∞°‡∞ø...", chat_open_aria:"‡∞ö‡∞æ‡∞ü‡±ç ‡∞ì‡∞™‡±Ü‡∞®‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø", chat_close_aria:"‡∞ö‡∞æ‡∞ü‡±ç ‡∞Æ‡±Ç‡∞∏‡∞ø‡∞µ‡±á‡∞Ø‡∞Ç‡∞°‡∞ø",
      chat_reply_default:"‡∞ï‡±ç‡∞∑‡∞Æ‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø, ‡∞®‡±á‡∞®‡±Å ‡∞¶‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞á‡∞™‡±ç‡∞™‡±Å‡∞°‡±á ‡∞Ö‡∞Æ‡∞≤‡±Å ‡∞ö‡±á‡∞Ø‡∞≤‡±á‡∞®‡±Å; ‡∞ï‡∞æ‡∞®‡±Ä ‡∞®‡±á‡∞®‡±Å ‡∞∏‡∞π‡∞æ‡∞Ø‡∞™‡∞°‡∞ó‡∞≤‡∞®‡±Å. ‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞Æ‡∞∞‡∞ø‡∞®‡±ç‡∞®‡∞ø ‡∞µ‡∞ø‡∞µ‡∞∞‡∞æ‡∞≤‡±Å ‡∞á‡∞µ‡±ç‡∞µ‡∞Ç‡∞°‡∞ø.",
      chat_reply_aerator:"‡∞é‡∞∞‡±á‡∞ü‡∞∞‡±ç‡∞≤ ‡∞ó‡±Å‡∞∞‡∞ø‡∞Ç‡∞ö‡∞ø ‡∞Æ‡±Ä‡∞∞‡±Å ‡∞è‡∞Æ‡∞ø ‡∞§‡±Ü‡∞≤‡±Å‡∞∏‡±Å‡∞ï‡±ã‡∞µ‡∞æ‡∞≤‡∞®‡±Å‡∞ï‡±Å‡∞Ç‡∞ü‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞∞‡±Å? ‡∞Æ‡±ã‡∞°‡∞≤‡±ç, ‡∞∏‡∞æ‡∞Æ‡∞∞‡±ç‡∞•‡±ç‡∞Ø‡∞Ç ‡∞≤‡±á‡∞¶‡∞æ ‡∞∏‡±á‡∞µ‡∞≤‡±Å?",
      chat_reply_history:"‡∞ö‡∞∞‡∞ø‡∞§‡±ç‡∞∞: ‡∞§‡∞æ‡∞ú‡∞æ ‡∞Ö‡∞™‡±ç‚Äå‡∞°‡±á‡∞ü‡±ç‡∞∏‡±ç ‡∞∏‡±à‡∞ü‡±ç ‡∞Ö‡∞°‡±ç‡∞Æ‡∞ø‡∞®‡±ç ‡∞¶‡±ç‡∞µ‡∞æ‡∞∞‡∞æ ‡∞®‡∞ø‡∞∞‡±ç‡∞µ‡∞π‡∞ø‡∞Ç‡∞™‡∞¨‡∞°‡∞ø ‡∞á‡∞ï‡±ç‡∞ï‡∞° ‡∞ö‡±Ç‡∞™‡∞¨‡∞°‡∞§‡∞æ‡∞Ø‡∞ø.",
      chat_more_info:"‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞Æ‡±Ä ‡∞∏‡∞Ç‡∞¶‡±á‡∞∂‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞µ‡∞ø‡∞µ‡∞∞‡∞Ç‡∞ó‡∞æ ‡∞ü‡±à‡∞™‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø.",
      purchase_request_subject:"‡∞ï‡±ä‡∞®‡±Å‡∞ó‡±ã‡∞≤‡±Å ‡∞Ö‡∞≠‡±ç‡∞Ø‡∞∞‡±ç‡∞•‡∞®"
    };

    /***********************
     * Helpers: DOM shortcuts
     ***********************/
    const $id = id => document.getElementById(id);
    const qs = s => document.querySelector(s);
    const qsa = s => Array.from(document.querySelectorAll(s));

    /***********************
     * i18n apply function
     ***********************/
    function applyI18n() {
      const lang = localStorage.getItem('lang') || 'te';
      document.documentElement.lang = lang;

      qsa('[data-i18n]').forEach(el => {
        const key = el.dataset.i18n;
        if (key && window.dict[lang] && window.dict[lang][key]) {
          el.textContent = window.dict[lang][key];
        }
      });

      // placeholders & special elements
      if ($id('pondArea')) $id('pondArea').placeholder = (lang === 'te' ? '‡∞â‡∞¶‡∞æ. 1000' : 'eg. 1000');
      if ($id('pondDepth')) $id('pondDepth').placeholder = (lang === 'te' ? '‡∞â‡∞¶‡∞æ. 1.2' : 'eg. 1.2');

      // chat placeholders & aria
      if ($id('chatInput')) $id('chatInput').placeholder = (window.dict[lang]['chat_placeholder'] || '');
      if ($id('openChat')) $id('openChat').setAttribute('aria-label', (window.dict[lang]['chat_open_aria'] || ''));
      if ($id('closeChat')) $id('closeChat').setAttribute('aria-label', (window.dict[lang]['chat_close_aria'] || ''));
      if ($id('chatTitle')) $id('chatTitle').textContent = (window.dict[lang]['chat_title'] || '');
    }

    /***********************
     * Tab logic (New / Old)
     ***********************/
    function setActiveTab(sub) {
      qsa('.tab').forEach(t => {
        const s = t.dataset.sub;
        if (s === sub) { t.classList.add('active'); t.setAttribute('aria-pressed','true'); }
        else { t.classList.remove('active'); t.setAttribute('aria-pressed','false'); }
      });

      // show/hide cards
      qsa('#modelsGrid [data-sub]').forEach(card => {
        if (card.dataset.sub === sub) card.style.display = '';
        else card.style.display = 'none';
      });
    }

    /***********************
     * Calculator logic
     ***********************/
    function estimateAerator(area, depth) {
      const volume_m3 = (area * depth);
      const liters = volume_m3 * 1000;
      const needed_lph = Math.max(500, Math.round(liters * 0.10)); // turnover 10%/hr heuristic
      const watts = Math.ceil(needed_lph / 25); // assume 25 L/h per Watt
      return { volume_m3: +volume_m3.toFixed(2), liters, needed_lph, watts };
    }

    function showCalcResult(obj) {
      const el = $id('calcResult');
      if (!el) return;
      const en = `Estimated pond: ${obj.volume_m3} m¬≥ (${Math.round(obj.liters).toLocaleString()} L). Recommend ~${obj.needed_lph} L/h (~${obj.watts} W).`;
      const te = `‡∞Ö‡∞Ç‡∞ö‡∞®‡∞æ ‡∞ö‡±Ü‡∞∞‡±Å‡∞µ‡±Å: ${obj.volume_m3} m¬≥ (${Math.round(obj.liters).toLocaleString()} L). ‡∞∏‡±Å‡∞Æ‡∞æ‡∞∞‡±Å ${obj.needed_lph} L/h (~${obj.watts} W) ‡∞Ö‡∞µ‡∞∏‡∞∞‡∞Ç.`;
      el.innerHTML = `<div class="font-medium">${en}</div><div class="text-sm text-slate-600 dark:text-slate-300 mt-1">${te}</div>`;
      el.classList.remove('hidden');
    }

    /***********************
     * Chat functions (bilingual)
     ***********************/
    function escapeHtml(str){ return (str||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
    function appendUserMessage(text) {
      const div = document.createElement('div'); div.className = 'msg user'; div.innerText = text; $id('chatMessages').appendChild(div); $id('chatMessages').scrollTop = $id('chatMessages').scrollHeight;
    }
    function appendBotMessage(en, te) {
      const div = document.createElement('div'); div.className = 'msg bot';
      div.innerHTML = `<div class="reply-en">${escapeHtml(en)}</div><div class="reply-te">${escapeHtml(te)}</div>`;
      $id('chatMessages').appendChild(div); $id('chatMessages').scrollTop = $id('chatMessages').scrollHeight;
    }
    function injectInitialGreeting() {
      const en = window.dict.en.chat_greeting || 'Hi! How can I help you today?';
      const te = window.dict.te.chat_greeting || '‡∞π‡∞æ‡∞Ø‡±ç! ‡∞®‡±á‡∞®‡±Å ‡∞à‡∞∞‡±ã‡∞ú‡±Å ‡∞é‡∞≤‡∞æ ‡∞∏‡∞π‡∞æ‡∞Ø‡∞Ç ‡∞ö‡±á‡∞Ø‡∞ó‡∞≤‡∞®ÔøΩÿü';
      appendBotMessage(en, te);
    }
    function botReply(userText) {
      const t = (userText||'').toLowerCase();
      let en = window.dict.en.chat_reply_default, te = window.dict.te.chat_reply_default;
      if (t.includes('aerator')||t.includes('‡∞é‡∞∞‡±á‡∞ü‡∞∞‡±ç')) { en = window.dict.en.chat_reply_aerator; te = window.dict.te.chat_reply_aerator; }
      else if (t.includes('history')||t.includes('‡∞ö‡∞∞‡∞ø‡∞§‡±ç‡∞∞')) { en = window.dict.en.chat_reply_history; te = window.dict.te.chat_reply_history; }
      else if ((userText||'').trim().length < 3) { en = window.dict.en.chat_more_info; te = window.dict.te.chat_more_info; }
      setTimeout(()=> appendBotMessage(en, te), 500);
    }

    /***********************
     * Purchase modal & flow
     ***********************/
    function openPurchaseModal(model, price) {
      $id('purchaseModel').value = model;
      $id('purchasePrice').value = price;
      $id('modalModel').textContent = `${model}${price ? ' ‚Ä¢ ‚Çπ' + price : ''}`;
      $id('buyerName').value = '';
      $id('buyerPhone').value = '';
      $id('buyerPlace').value = '';
      $id('modalOverlay').classList.add('open');
      $id('modalOverlay').setAttribute('aria-hidden','false');
    }
    function closePurchaseModal() {
      $id('modalOverlay').classList.remove('open');
      $id('modalOverlay').setAttribute('aria-hidden','true');
    }
    function submitPurchaseForm(e) {
      e.preventDefault();
      const model = $id('purchaseModel').value;
      const price = $id('purchasePrice').value;
      const name = $id('buyerName').value.trim();
      const phone = $id('buyerPhone').value.trim();
      const place = $id('buyerPlace').value.trim();

      if (!name || !phone) { alert(localStorage.getItem('lang') === 'te' ? '‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞™‡±á‡∞∞‡±Å ‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞´‡±ã‡∞®‡±ç ‡∞®‡∞Ç‡∞¨‡∞∞‡±ç ‡∞á‡∞µ‡±ç‡∞µ‡∞Ç‡∞°‡∞ø.' : 'Please enter name and phone number.'); return; }

      // Primary flow: open chat and prefill purchase message (bilingual)
      const chatBtn = $id('openChat');
      if (chatBtn) chatBtn.click(); // opens chat panel
      setTimeout(() => {
        const input = $id('chatInput');
        if (input) {
          const en = `Purchase request: ${model}${price ? ' (‚Çπ' + price + ')' : ''}. Buyer: ${name}, Phone: ${phone}, Place: ${place || '-'} .`;
          const te = `‡∞ï‡±ä‡∞®‡±Å‡∞ó‡±ã‡∞≤‡±Å ‡∞Ö‡∞≠‡±ç‡∞Ø‡∞∞‡±ç‡∞•‡∞®: ${model}${price ? ' (‚Çπ' + price + ')' : ''}. ‡∞ï‡±ä‡∞®‡±Å‡∞ó‡±ã‡∞≤‡±Å ‡∞¶‡∞æ‡∞∞‡±Å‡∞°‡±Å: ${name}, ‡∞´‡±ã‡∞®‡±ç: ${phone}, ‡∞∏‡±ç‡∞•‡∞≤‡∞Ç: ${place || '-'}.`;
          input.value = `${en}\n${te}`;
          input.focus();
        } else {
          // fallback: mailto (opens user's mail client)
          const subject = encodeURIComponent(window.dict[localStorage.getItem('lang')||'te'].purchase_request_subject || 'Purchase request');
          const body = encodeURIComponent(`${model} (${price ? '‚Çπ' + price : ''})\nName: ${name}\nPhone: ${phone}\nPlace: ${place}\n\nPlease contact me.`);
          window.location.href = `mailto:info@example.com?subject=${subject}&body=${body}`;
        }
      }, 300);

      closePurchaseModal();
    }

    /***********************
     * Initialize page
     ***********************/
    document.addEventListener('DOMContentLoaded', () => {
      // set default lang
      if (!localStorage.getItem('lang')) localStorage.setItem('lang','te');
      $id('langSel').value = localStorage.getItem('lang') || 'te';
      applyI18n();

      // theme toggle
      const saved = localStorage.getItem('theme');
      if (saved === 'dark' || (!saved && matchMedia('(prefers-color-scheme: dark)').matches)) document.documentElement.classList.add('dark');
      $id('themeToggle').addEventListener('click', () => {
        document.documentElement.classList.toggle('dark');
        localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
      });

      // tabs wiring
      $id('tabNew').addEventListener('click', () => setActiveTab('new'));
      $id('tabOld').addEventListener('click', () => setActiveTab('old'));
      setActiveTab('new'); // default

      // calc wiring
      $id('calcBtn').addEventListener('click', () => {
        const area = parseFloat($id('pondArea').value) || 0;
        const depth = parseFloat($id('pondDepth').value) || 0;
        if (area <= 0 || depth <= 0) return alert(localStorage.getItem('lang') === 'te' ? '‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞∏‡∞∞‡±à‡∞® ‡∞µ‡∞ø‡∞≤‡±Å‡∞µ‡∞≤‡±Å ‡∞á‡∞µ‡±ç‡∞µ‡∞Ç‡∞°‡∞ø.' : 'Please enter valid values.');
        const res = estimateAerator(area, depth);
        showCalcResult(res);
      });
      $id('calcReset').addEventListener('click', () => {
        $id('pondArea').value = ''; $id('pondDepth').value = ''; $id('calcResult').classList.add('hidden'); $id('calcResult').innerHTML = '';
      });

      // chat wiring
      const openChat = $id('openChat'), chatPanel = $id('chatPanel'), closeChat = $id('closeChat'), sendBtn = $id('sendBtn'), chatInput = $id('chatInput');
      injectInitialGreeting();
      openChat.addEventListener('click', () => { chatPanel.classList.add('open'); applyI18n(); chatInput.focus(); });
      closeChat.addEventListener('click', () => { chatPanel.classList.remove('open'); openChat.focus(); });
      sendBtn.addEventListener('click', () => { const txt = chatInput.value.trim(); if (!txt) return; appendUserMessage(txt); chatInput.value = ''; botReply(txt); });
      chatInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') { e.preventDefault(); sendBtn.click(); } });
      document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && chatPanel.classList.contains('open')) { chatPanel.classList.remove('open'); openChat.focus(); }});

      // model buttons (Request Quote, Specs, Buy)
      document.body.addEventListener('click', (ev) => {
        const t = ev.target;
        if (!t) return;
        // Specs
        if (t.matches && t.matches('.btn-specs')) {
          const specs = JSON.parse(t.getAttribute('data-specs') || '{}');
          const flow = specs.flow || '-', power = specs.power || '-';
          const lang = localStorage.getItem('lang') || 'te';
          const en = `Specs ‚Äî Flow: ${flow}, Power: ${power}`;
          const te = `‡∞µ‡∞ø‡∞µ‡∞∞‡∞æ‡∞≤‡±Å ‚Äî ‡∞´‡±ç‡∞≤‡±ã: ${flow}, ‡∞∂‡∞ï‡±ç‡∞§‡∞ø: ${power}`;
          alert(`${en}\n\n${te}`);
          return;
        }
        // Request Quote
        if (t.matches && t.matches('.btn-request')) {
          const model = t.getAttribute('data-model') || 'Model';
          const price = t.getAttribute('data-price') || '';
          // open chat and prefill bilingual message
          const chatBtn = $id('openChat');
          if (chatBtn) chatBtn.click();
          setTimeout(() => {
            const input = $id('chatInput');
            if (input) {
              const enMsg = `Requesting quote for ${model}${price ? ' (‚Çπ' + price + ')' : ''}. Please assist.`;
              const teMsg = `‡∞®‡∞æ‡∞ï‡±Å ${model}${price ? ' (‚Çπ' + price + ')' : ''} ‡∞ï‡±ä‡∞∞‡∞ï‡±Å ‡∞ï‡±ã‡∞ü‡±ç ‡∞ï‡∞æ‡∞µ‡∞æ‡∞≤‡∞ø. ‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞∏‡∞π‡∞æ‡∞Ø‡∞Ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø.`;
              input.value = `${enMsg}\n${teMsg}`;
              input.focus();
            } else {
              alert(localStorage.getItem('lang') === 'te' ? `‡∞ï‡±ã‡∞ü‡±ç ‡∞ï‡±ã‡∞∏‡∞Ç ${model} ‡∞ï‡±ã‡∞∞‡∞Ç‡∞°‡∞ø.` : `Requested quote for ${model}.`);
            }
          }, 300);
          return;
        }
        // Buy
        if (t.matches && t.matches('.btn-buy')) {
          const model = t.getAttribute('data-model') || 'Model';
          const price = t.getAttribute('data-price') || '';
          openPurchaseModal(model, price);
          return;
        }
      });

      // purchase modal wiring
      $id('modalClose').addEventListener('click', closePurchaseModal);
      $id('purchaseCancel').addEventListener('click', closePurchaseModal);
      $id('purchaseForm').addEventListener('submit', submitPurchaseForm);

      // lang select change
      $id('langSel').addEventListener('change', (e) => {
        localStorage.setItem('lang', e.target.value);
        applyI18n();
      });
    });
  </script>
</body>
</html>
